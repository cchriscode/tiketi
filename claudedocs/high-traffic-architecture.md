# ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ì²˜ë¦¬ ì•„í‚¤í…ì²˜

**ì‹œë‚˜ë¦¬ì˜¤**: ì¸ê¸° ì½˜ì„œíŠ¸ í‹°ì¼“ ì˜¤í”ˆ - 10ë§Œ ëª… ë™ì‹œ ì ‘ì†
**ì‘ì„±ì¼**: 2026-01-08

---

## ğŸ“Š ì‹œë‚˜ë¦¬ì˜¤: 10ë§Œ ëª… ë™ì‹œ ì ‘ì†

### ìƒí™©
```
ì˜¤í›„ 8ì‹œ ì •ê° - BTS ì½˜ì„œíŠ¸ í‹°ì¼“ ì˜¤í”ˆ
â”œâ”€ ëŒ€ê¸° ì¤‘ì¸ ì‚¬ìš©ì: 100,000ëª…
â”œâ”€ í‹°ì¼“ ì˜¤í”ˆ ì‹œê°„: 2026-01-15 20:00:00
â”œâ”€ ë™ì‹œ ì…ì¥ ê°€ëŠ¥ ì¸ì›: 1,000ëª…
â””â”€ ì˜ˆìƒ í‹°ì¼“ íŒë§¤ ì‹œê°„: 5ë¶„ ë‚´ ì™„íŒ
```

---

## 1. íŠ¸ë˜í”½ íë¦„ (ì „ì²´)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    100,000ëª… ë™ì‹œ ì ‘ì†                            â”‚
â”‚                    (20:00:00 ~ 20:00:05)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Route53 DNS   â”‚
                    â”‚  tiketi.store   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   ALB (Application Load       â”‚
              â”‚   Balancer) - Multi-AZ        â”‚
              â”‚   - ìë™ ìŠ¤ì¼€ì¼ë§              â”‚
              â”‚   - Connection Pooling        â”‚
              â”‚   - Health Check              â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         íŠ¸ë˜í”½ ë¶„ì‚° (Round Robin)        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“       â†“       â†“       â†“       â†“
    â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
    â”‚ Pod â”‚ â”‚ Pod â”‚ â”‚ Pod â”‚ â”‚ Pod â”‚ â”‚ Pod â”‚
    â”‚  1  â”‚ â”‚  2  â”‚ â”‚  3  â”‚ â”‚  4  â”‚ â”‚  5  â”‚
    â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜
       â†“       â†“       â†“       â†“       â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   ElastiCache Redis Multi-AZ      â”‚
    â”‚   (ëŒ€ê¸°ì—´ ìƒíƒœ ì¤‘ì•™ ê´€ë¦¬)           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ALB (Application Load Balancer) ê´€ì 

### ALBì˜ ì—­í• 

#### A. íŠ¸ë˜í”½ ìˆ˜ì‹  ë° ë¶„ì‚°
```
100,000 ë™ì‹œ ì ‘ì† ìš”ì²­
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ALB - Connection Handling                   â”‚
â”‚                                             â”‚
â”‚ - Max Connections: ìˆ˜ì‹­ë§Œ ê°œ               â”‚
â”‚ - Connection Timeout: 60ì´ˆ                 â”‚
â”‚ - Idle Timeout: 60ì´ˆ                       â”‚
â”‚ - Keep-Alive: í™œì„±í™”                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ìë™ ë¶„ì‚° â†’ 5ê°œ Pod (EKS Nodes)
```

**ë¶„ì‚° ë°©ì‹** (Round Robin):
```
ìš”ì²­ #1 â†’ Pod 1
ìš”ì²­ #2 â†’ Pod 2
ìš”ì²­ #3 â†’ Pod 3
ìš”ì²­ #4 â†’ Pod 4
ìš”ì²­ #5 â†’ Pod 5
ìš”ì²­ #6 â†’ Pod 1 (ë°˜ë³µ)
...
```

**ì´ˆë‹¹ ì²˜ë¦¬ëŸ‰ (ì˜ˆìƒ)**:
```
Podë‹¹ ì²˜ë¦¬ ëŠ¥ë ¥: ~2,000 req/s
5ê°œ Pod í•©ê³„: ~10,000 req/s
100,000ëª… ì ‘ì†: 10ì´ˆ ë‚´ ëª¨ë“  ìš”ì²­ ìˆ˜ì‹  ê°€ëŠ¥
```

#### B. Health Checkë¡œ ì¥ì•  Pod ì œì™¸

```yaml
Health Check ì„¤ì •:
  Path: /health
  Interval: 30ì´ˆ
  Timeout: 5ì´ˆ
  Healthy Threshold: 2
  Unhealthy Threshold: 2
```

**ë™ì‘**:
```
Pod 3ì´ ì‘ë‹µ ì—†ìŒ (2íšŒ)
    â†“
ALBê°€ Pod 3ì„ íŠ¸ë˜í”½ì—ì„œ ì œì™¸
    â†“
ë‚˜ë¨¸ì§€ 4ê°œ Podë¡œë§Œ ë¶„ì‚°
    â†“
Pod 3 ë³µêµ¬ë˜ë©´ ìë™ìœ¼ë¡œ ë‹¤ì‹œ í¬í•¨
```

#### C. Connection Pooling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ALB Connection Pool                 â”‚
â”‚                                      â”‚
â”‚  100,000ê°œ í´ë¼ì´ì–¸íŠ¸ ì—°ê²°           â”‚
â”‚       â†“                              â”‚
â”‚  ALBê°€ ì—°ê²° ìœ ì§€ ë° ì¬ì‚¬ìš©           â”‚
â”‚       â†“                              â”‚
â”‚  Podì™€ëŠ” Keep-Aliveë¡œ ì ì€ ì—°ê²°      â”‚
â”‚  (ì˜ˆ: 500ê°œ ì •ë„ë§Œ ìœ ì§€)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì´ì **:
- í´ë¼ì´ì–¸íŠ¸: 100,000ê°œ ì—°ê²°
- Pod: 500ê°œ ì—°ê²° (ALBê°€ í”„ë¡ì‹œ ì—­í• )
- Podì˜ ë¶€í•˜ ëŒ€í­ ê°ì†Œ

#### D. ìë™ ìŠ¤ì¼€ì¼ë§ (AWS ê´€ë¦¬)

```
íŠ¸ë˜í”½ ê¸‰ì¦ ê°ì§€
    â†“
ALB ìë™ìœ¼ë¡œ Capacity ì¦ê°€
    â†“
ì¶”ê°€ ë¦¬ì†ŒìŠ¤ í• ë‹¹ (AWS ìë™ ì²˜ë¦¬)
    â†“
ì²˜ë¦¬ ëŠ¥ë ¥ ì¦ëŒ€
```

**íŠ¹ì§•**:
- ì‚¬ìš©ìê°€ ì„¤ì • ë¶ˆí•„ìš”
- AWSê°€ ìë™ìœ¼ë¡œ ê´€ë¦¬
- ë¹„ìš©ì€ ì‚¬ìš©ëŸ‰ì— ë”°ë¼ ìë™ ì¦ê°€

---

## 3. ëŒ€ê¸°ì—´ ì‹œìŠ¤í…œ ê´€ì 

### A. íŠ¸ë˜í”½ í­ì¦ ì‹œ ì²˜ë¦¬ íë¦„

#### íƒ€ì„ë¼ì¸: 20:00:00 ~ 20:00:10

```
20:00:00 - í‹°ì¼“ ì˜¤í”ˆ
â”œâ”€ 0ì´ˆ: 10,000ëª… ë™ì‹œ ìš”ì²­ (ì²« ë¬¼ê²°)
â”‚   â†“
â”‚   POST /api/queue/check/{eventId} Ã— 10,000
â”‚   â†“
â”‚   í˜„ì¬ í™œì„± ì‚¬ìš©ì: 0ëª…
â”‚   ì„ê³„ê°’: 1,000ëª…
â”‚   â†“
â”‚   ê²°ê³¼:
â”‚   â”œâ”€ ì²˜ìŒ 1,000ëª… â†’ ì¦‰ì‹œ ì…ì¥ (active:{eventId})
â”‚   â””â”€ ë‚˜ë¨¸ì§€ 9,000ëª… â†’ ëŒ€ê¸°ì—´ ì¶”ê°€ (queue:{eventId})
â”‚
â”œâ”€ 1ì´ˆ: 20,000ëª… ì¶”ê°€ ìš”ì²­
â”‚   â†“
â”‚   í˜„ì¬ í™œì„±: 1,000ëª…
â”‚   ëŒ€ê¸°ì—´: 9,000ëª…
â”‚   â†“
â”‚   ê²°ê³¼: 20,000ëª… ì „ì› ëŒ€ê¸°ì—´ ì¶”ê°€
â”‚   â””â”€ ëŒ€ê¸°ì—´ ì´: 29,000ëª…
â”‚
â”œâ”€ 2-5ì´ˆ: ë‚˜ë¨¸ì§€ 70,000ëª… ìš”ì²­
â”‚   â†“
â”‚   ê²°ê³¼: ì „ì› ëŒ€ê¸°ì—´ ì¶”ê°€
â”‚   â””â”€ ëŒ€ê¸°ì—´ ì´: 99,000ëª…
â”‚
â””â”€ 6-10ì´ˆ: ëŒ€ê¸°ì—´ì—ì„œ ìˆœì°¨ ì…ì¥ ì‹œì‘
    â†“
    Queue Processor (10ì´ˆë§ˆë‹¤)
    â†“
    í™œì„± ì‚¬ìš©ì ìë¦¬ ë‚˜ë©´ ìë™ ì…ì¥
```

### B. Redis ë°ì´í„° êµ¬ì¡° (ì‹¤ì‹œê°„)

#### 20:00:00 (í‹°ì¼“ ì˜¤í”ˆ ì§í›„)

```redis
# í™œì„± ì‚¬ìš©ì (Set) - í˜„ì¬ ì…ì¥í•œ ì‚¬ëŒë“¤
active:event-123
â”œâ”€ user-1
â”œâ”€ user-2
â”œâ”€ ...
â””â”€ user-1000  (1,000ëª… ì œí•œ)

# ëŒ€ê¸°ì—´ (Sorted Set) - FIFO ìˆœì„œ
queue:event-123
â”œâ”€ user-1001 (score: 1736345600001)  â† 1ë²ˆì§¸
â”œâ”€ user-1002 (score: 1736345600002)  â† 2ë²ˆì§¸
â”œâ”€ user-1003 (score: 1736345600003)  â† 3ë²ˆì§¸
â”œâ”€ ...
â””â”€ user-100000 (score: 1736345605000) â† 99,000ë²ˆì§¸

# ëŒ€ê¸°ì—´ í¬ê¸°
ZCARD queue:event-123
â†’ 99,000

# í™œì„± ì‚¬ìš©ì ìˆ˜
SCARD active:event-123
â†’ 1,000
```

#### API ì‘ë‹µ ì˜ˆì‹œ

**ì¦‰ì‹œ ì…ì¥ (ì²˜ìŒ 1,000ëª…)**:
```json
{
  "queued": false,
  "currentUsers": 1000,
  "threshold": 1000,
  "eventInfo": {
    "title": "BTS Concert",
    "artist": "BTS"
  }
}
```

**ëŒ€ê¸°ì—´ ì§„ì… (1,001ë²ˆì§¸ ì‚¬ìš©ì)**:
```json
{
  "queued": true,
  "position": 1,
  "estimatedWait": 30,
  "threshold": 1000,
  "currentUsers": 1000,
  "eventInfo": {
    "title": "BTS Concert",
    "artist": "BTS"
  }
}
```

**ëŒ€ê¸°ì—´ ì§„ì… (50,000ë²ˆì§¸ ì‚¬ìš©ì)**:
```json
{
  "queued": true,
  "position": 49000,
  "estimatedWait": 1470000,  // 49,000 Ã— 30ì´ˆ = 408ì‹œê°„ (ì‹¤ì œë¡œëŠ” í›¨ì”¬ ë¹ ë¦„)
  "threshold": 1000,
  "currentUsers": 1000
}
```

### C. Queue Processor ë™ì‘ (10ì´ˆë§ˆë‹¤)

```javascript
// 20:00:10 - ì²« ë²ˆì§¸ Queue Processor ì‹¤í–‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Queue Processor Cycle #1                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ 1. ë¹„í™œì„± ì‚¬ìš©ì ì œê±° (90ì´ˆ ë¬´ì‘ë‹µ)             â”‚
â”‚    â”œâ”€ active:seen:{eventId} í™•ì¸                â”‚
â”‚    â”œâ”€ 90ì´ˆ ì „ë³´ë‹¤ ì˜¤ë˜ëœ ì‚¬ìš©ì ì°¾ê¸°             â”‚
â”‚    â””â”€ active:{eventId}ì—ì„œ ì œê±°                 â”‚
â”‚    ê²°ê³¼: 100ëª… ì œê±° (íƒ€ì„ì•„ì›ƒ)                   â”‚
â”‚                                                 â”‚
â”‚ 2. í˜„ì¬ ìƒíƒœ í™•ì¸                               â”‚
â”‚    â”œâ”€ í˜„ì¬ í™œì„±: 900ëª… (1000 - 100 ì œê±°)        â”‚
â”‚    â”œâ”€ ì„ê³„ê°’: 1000ëª…                            â”‚
â”‚    â””â”€ ì…ì¥ ê°€ëŠ¥: 100ëª…                          â”‚
â”‚                                                 â”‚
â”‚ 3. ëŒ€ê¸°ì—´ì—ì„œ 100ëª… ì…ì¥                        â”‚
â”‚    â”œâ”€ ZRANGE queue:event-123 0 99               â”‚
â”‚    â”‚   â†’ user-1001 ~ user-1100 (100ëª…)          â”‚
â”‚    â”‚                                             â”‚
â”‚    â”œâ”€ ê° ì‚¬ìš©ìë¥¼ active:{eventId}ë¡œ ì´ë™       â”‚
â”‚    â”œâ”€ queue:{eventId}ì—ì„œ ì œê±°                  â”‚
â”‚    â””â”€ Socket.IO ì´ë²¤íŠ¸ ë°œí–‰                     â”‚
â”‚       â””â”€ 'queue-entry-allowed' â†’ 100ëª…ì—ê²Œ ì•Œë¦¼ â”‚
â”‚                                                 â”‚
â”‚ 4. ëŒ€ê¸°ì—´ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸                       â”‚
â”‚    â””â”€ 'queue-updated' â†’ ëŒ€ê¸° ì¤‘ì¸ ëª¨ë“  ì‚¬ëŒ     â”‚
â”‚       {                                         â”‚
â”‚         queueSize: 98,900,                      â”‚
â”‚         currentUsers: 1000,                     â”‚
â”‚         threshold: 1000                         â”‚
â”‚       }                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// 20:00:20 - ë‘ ë²ˆì§¸ Cycle
// 20:00:30 - ì„¸ ë²ˆì§¸ Cycle
// ... ê³„ì† ë°˜ë³µ
```

### D. Redis Commands (ì„±ëŠ¥)

**RedisëŠ” Single-Threadedì´ì§€ë§Œ ë§¤ìš° ë¹ ë¦„**:

```
ì„±ëŠ¥ í…ŒìŠ¤íŠ¸:
â”œâ”€ ZADD (ëŒ€ê¸°ì—´ ì¶”ê°€): ~10,000 ops/sec
â”œâ”€ ZRANK (ìˆœìœ„ ì¡°íšŒ): ~100,000 ops/sec
â”œâ”€ ZRANGE (ë²”ìœ„ ì¡°íšŒ): ~50,000 ops/sec
â”œâ”€ SADD (í™œì„± ì¶”ê°€): ~100,000 ops/sec
â””â”€ SCARD (ê°œìˆ˜ í™•ì¸): ~100,000 ops/sec

100,000ëª… ë™ì‹œ ì ‘ì† ì‹œ:
â”œâ”€ ëŒ€ê¸°ì—´ ì¶”ê°€ (ZADD Ã— 99,000): ~10ì´ˆ
â”œâ”€ ìˆœìœ„ ì¡°íšŒ (ZRANK): ì¦‰ì‹œ
â””â”€ Redis ë³‘ëª© í˜„ìƒ: ê±°ì˜ ì—†ìŒ
```

**ë³‘ëª©ì€ Redisê°€ ì•„ë‹Œ Network/DB**:
- âœ… Redis: ì´ˆë‹¹ 10ë§Œ ops ê°€ëŠ¥
- âš ï¸ Network: ALB â†’ Pod ì—°ê²°
- âš ï¸ PostgreSQL: ì¢Œì„ ì¡°íšŒ/ì˜ˆì•½

---

## 4. Multi-Pod í™˜ê²½ì—ì„œì˜ ë™ê¸°í™”

### A. Redis Pub/Subìœ¼ë¡œ ì‹¤ì‹œê°„ ë™ê¸°í™”

```
Pod 1ì—ì„œ ì‚¬ìš©ì ì…ì¥ ì²˜ë¦¬
    â†“
Redis PUBLISH 'tiketi:queue-events'
    {
      event: 'queue-entry-allowed',
      payload: {
        eventId: 'event-123',
        userId: 'user-1001',
        message: 'ì…ì¥ì´ í—ˆìš©ë˜ì—ˆìŠµë‹ˆë‹¤.'
      }
    }
    â†“
ëª¨ë“  Podê°€ SUBSCRIBEë¡œ ìˆ˜ì‹ 
    â†“
ê° Podì˜ Socket.IOê°€ í•´ë‹¹ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
    â†“
ì‚¬ìš©ì ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤ì‹œê°„ ì•Œë¦¼ ìˆ˜ì‹ 
```

### B. Socket.IO Redis Adapter

```javascript
// ê° Podë§ˆë‹¤ Socket.IO ì„œë²„ ì‹¤í–‰
Pod 1: Socket.IO Server (100ê°œ í´ë¼ì´ì–¸íŠ¸ ì—°ê²°)
Pod 2: Socket.IO Server (100ê°œ í´ë¼ì´ì–¸íŠ¸ ì—°ê²°)
Pod 3: Socket.IO Server (100ê°œ í´ë¼ì´ì–¸íŠ¸ ì—°ê²°)
Pod 4: Socket.IO Server (100ê°œ í´ë¼ì´ì–¸íŠ¸ ì—°ê²°)
Pod 5: Socket.IO Server (100ê°œ í´ë¼ì´ì–¸íŠ¸ ì—°ê²°)

ì´ 500ê°œ ë™ì‹œ WebSocket ì—°ê²°

Redis Adapter ì—­í• :
â”œâ”€ Pod 1ì—ì„œ ë°œí–‰í•œ ì´ë²¤íŠ¸ â†’ Redis Pub/Sub
â”œâ”€ Redisê°€ ëª¨ë“  Podì—ê²Œ ì „íŒŒ
â””â”€ ê° Podê°€ ìì‹ ì˜ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ë‹¬
```

**ì˜ˆì‹œ**:
```
user-1001ì´ Pod 3ì— WebSocket ì—°ê²°
    â†“
Pod 1ì˜ Queue Processorê°€ user-1001 ì…ì¥ í—ˆìš©
    â†“
Pod 1 â†’ Redis PUBLISH 'queue-entry-allowed'
    â†“
Redis â†’ ëª¨ë“  Podì—ê²Œ ì „íŒŒ
    â†“
Pod 3ì´ ë©”ì‹œì§€ ìˆ˜ì‹ 
    â†“
Pod 3 â†’ user-1001ì˜ WebSocketìœ¼ë¡œ ì „ì†¡
    â†“
user-1001 ë¸Œë¼ìš°ì €: "ì…ì¥ì´ í—ˆìš©ë˜ì—ˆìŠµë‹ˆë‹¤" ì•Œë¦¼
```

---

## 5. ë³‘ëª© ì§€ì  ë° í•´ê²°ì±…

### ë³‘ëª© ì§€ì  ë¶„ì„

#### A. ALB ë³‘ëª© (ê±°ì˜ ì—†ìŒ)
```
ALB ì²˜ë¦¬ ëŠ¥ë ¥: ìˆ˜ì‹­ë§Œ req/s
í˜„ì¬ ë¶€í•˜: 10,000 req/s (10ì´ˆê°„)
ë³‘ëª© ê°€ëŠ¥ì„±: âŒ ì—†ìŒ (ì—¬ìœ  ì¶©ë¶„)
```

#### B. EKS Pod ë³‘ëª© (ìˆì„ ìˆ˜ ìˆìŒ)
```
Podë‹¹ ì²˜ë¦¬ ëŠ¥ë ¥: ~2,000 req/s
5ê°œ Pod: 10,000 req/s
100,000ëª… ë™ì‹œ: 10ì´ˆ ë‚´ ì²˜ë¦¬ ê°€ëŠ¥

ë¬¸ì œ ìƒí™©:
â”œâ”€ CPU/ë©”ëª¨ë¦¬ ë¶€ì¡± ì‹œ Pod ëŠë ¤ì§
â””â”€ í•´ê²°: HPA (Horizontal Pod Autoscaler)
```

**HPA ì„¤ì •** (`k8s/overlays/prod/hpa.yaml`):
```yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: ticket-service-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: ticket-service
  minReplicas: 5
  maxReplicas: 20
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
```

**ë™ì‘**:
```
CPU ì‚¬ìš©ë¥  > 70%
    â†“
HPAê°€ Pod ì¶”ê°€ (5 â†’ 10)
    â†“
íŠ¸ë˜í”½ ë¶„ì‚° (10ê°œ Pod)
    â†“
CPU ì‚¬ìš©ë¥  ê°ì†Œ (50%)
    â†“
ì•ˆì •í™”
```

#### C. Redis ë³‘ëª© (ê±°ì˜ ì—†ìŒ)
```
ElastiCache Redis ì„±ëŠ¥:
â”œâ”€ Read: 100,000+ ops/sec
â”œâ”€ Write: 10,000+ ops/sec
â””â”€ Multi-AZë¡œ ê³ ê°€ìš©ì„±

í˜„ì¬ ë¶€í•˜:
â”œâ”€ ëŒ€ê¸°ì—´ ì¶”ê°€: ~10,000 writes/sec (í”¼í¬)
â”œâ”€ ìˆœìœ„ ì¡°íšŒ: ~5,000 reads/sec
â””â”€ ë³‘ëª© ê°€ëŠ¥ì„±: âŒ ì—†ìŒ
```

#### D. PostgreSQL ë³‘ëª© (ìˆì„ ìˆ˜ ìˆìŒ)
```
RDS PostgreSQL ì„±ëŠ¥:
â”œâ”€ Connection Pool: 100ê°œ
â”œâ”€ ì¢Œì„ ì¡°íšŒ Query: ~100ms
â””â”€ ì˜ˆì•½ íŠ¸ëœì­ì…˜: ~200ms

ë¬¸ì œ ìƒí™©:
â”œâ”€ 1,000ëª…ì´ ë™ì‹œì— ì¢Œì„ ì¡°íšŒ
â”‚   â†“
â”‚   100ms Ã— 1,000 = 100,000ms (100ì´ˆ?)
â”‚
â””â”€ í•´ê²°ì±…:
    â”œâ”€ Connection Pool ì¦ê°€
    â”œâ”€ Read Replica ì‚¬ìš©
    â””â”€ ì¢Œì„ ì •ë³´ Redis ìºì‹±
```

**ê°œì„  ë°©ì•ˆ**:
```javascript
// ì¢Œì„ ì •ë³´ Redis ìºì‹±
const cachedSeats = await redisClient.get(`seats:${eventId}`);
if (cachedSeats) {
  return JSON.parse(cachedSeats);
}

const seats = await db.query('SELECT * FROM seats WHERE event_id = $1', [eventId]);
await redisClient.setex(`seats:${eventId}`, 60, JSON.stringify(seats.rows));
return seats.rows;
```

---

## 6. ì‹¤ì œ ì‹œë‚˜ë¦¬ì˜¤ë³„ ì²˜ë¦¬

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì •ìƒ íŠ¸ë˜í”½ (1,000ëª…)

```
1,000ëª… ì ‘ì†
    â†“
ALB â†’ 5ê°œ Pod ë¶„ì‚° (ê° 200ëª…)
    â†“
ì „ì› ì¦‰ì‹œ ì…ì¥ (active:{eventId})
    â†“
ëŒ€ê¸°ì—´ ì—†ìŒ
    â†“
ì¢Œì„ ì„ íƒ â†’ ì˜ˆì•½ â†’ ê²°ì œ
```

**ì²˜ë¦¬ ì‹œê°„**: ì¦‰ì‹œ (< 1ì´ˆ)

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì¤‘ê°„ íŠ¸ë˜í”½ (5,000ëª…)

```
5,000ëª… ì ‘ì†
    â†“
ì²˜ìŒ 1,000ëª… â†’ ì¦‰ì‹œ ì…ì¥
ë‚˜ë¨¸ì§€ 4,000ëª… â†’ ëŒ€ê¸°ì—´
    â†“
Queue Processor (10ì´ˆë§ˆë‹¤ 100ëª… ì…ì¥)
    â†“
4,000ëª… ì „ì› ì…ì¥ê¹Œì§€: ~400ì´ˆ (6ë¶„ 40ì´ˆ)
```

**ì²˜ë¦¬ ì‹œê°„**: 1ë²ˆì§¸ ì‚¬ìš©ì ì¦‰ì‹œ, 4,000ë²ˆì§¸ ì‚¬ìš©ì ~7ë¶„

### ì‹œë‚˜ë¦¬ì˜¤ 3: í­ë°œì  íŠ¸ë˜í”½ (100,000ëª…)

```
20:00:00 - 100,000ëª… ë™ì‹œ ì ‘ì†
    â†“
0-10ì´ˆ: ëª¨ë“  ìš”ì²­ ìˆ˜ì‹  (ALB ì²˜ë¦¬)
    â”œâ”€ ì²˜ìŒ 1,000ëª… â†’ ì¦‰ì‹œ ì…ì¥
    â””â”€ ë‚˜ë¨¸ì§€ 99,000ëª… â†’ ëŒ€ê¸°ì—´ ì¶”ê°€
    â†“
10ì´ˆë§ˆë‹¤ Queue Processor ì‹¤í–‰
    â”œâ”€ ë¹„í™œì„± ì‚¬ìš©ì ì œê±° (~100ëª…)
    â””â”€ ìƒˆë¡œ 100ëª… ì…ì¥
    â†“
ëŒ€ê¸°ì—´ ì†Œí™” ì†ë„:
    â”œâ”€ 10ì´ˆë§ˆë‹¤ 100ëª…
    â”œâ”€ 1ë¶„ì— 600ëª…
    â”œâ”€ 1ì‹œê°„ì— 36,000ëª…
    â””â”€ 99,000ëª… ì „ì²´: ~2.75ì‹œê°„
```

**ë¬¸ì œ**: ë„ˆë¬´ ëŠë¦¼! ê°œì„  í•„ìš”

### ê°œì„  ë°©ì•ˆ

#### A. Queue Processor ì£¼ê¸° ë‹¨ì¶•
```javascript
// í˜„ì¬: 10ì´ˆë§ˆë‹¤ 100ëª…
// ê°œì„ : 5ì´ˆë§ˆë‹¤ 200ëª…

QUEUE_PROCESSOR_INTERVAL=5000
QUEUE_THRESHOLD=1000

ê²°ê³¼:
â”œâ”€ 5ì´ˆë§ˆë‹¤ ì²˜ë¦¬
â”œâ”€ ë¹„í™œì„± ì‚¬ìš©ì ë” ë§ì´ ì œê±° (íšŒì „ìœ¨ ì¦ê°€)
â””â”€ 99,000ëª… ì†Œí™”: ~1.4ì‹œê°„
```

#### B. ë™ì  ì„ê³„ê°’ ì¦ê°€
```javascript
// íŠ¸ë˜í”½ í­ì¦ ê°ì§€ ì‹œ ì„ê³„ê°’ ìë™ ì¦ê°€
if (queueSize > 50000) {
  threshold = 5000;  // 1,000 â†’ 5,000
}

ê²°ê³¼:
â”œâ”€ 5ë°° ë§ì€ ì‚¬ìš©ì ë™ì‹œ ì…ì¥
â”œâ”€ ëŒ€ê¸°ì—´ ì†Œí™” ì†ë„ 5ë°° ì¦ê°€
â””â”€ 99,000ëª… ì†Œí™”: ~16ë¶„
```

#### C. HPAë¡œ Pod ìë™ ì¦ê°€
```yaml
maxReplicas: 20  # 5 â†’ 20 (4ë°° ì¦ê°€)

ê²°ê³¼:
â”œâ”€ CPU ë¶€í•˜ ê°ì§€ ì‹œ Pod ìë™ ì¦ê°€
â”œâ”€ 20ê°œ Pod â†’ ì²˜ë¦¬ ëŠ¥ë ¥ 4ë°°
â”œâ”€ Queue Processorë„ 20ê°œ ì‹¤í–‰
â””â”€ ë³‘ë ¬ ì²˜ë¦¬ë¡œ ì†ë„ í–¥ìƒ
```

---

## 7. ëª¨ë‹ˆí„°ë§ ë° ì•ŒëŒ

### Prometheus Metrics

```
# ëŒ€ê¸°ì—´ í¬ê¸°
tiketi_queue_size{eventId="event-123"} 99000

# í™œì„± ì‚¬ìš©ì ìˆ˜
tiketi_active_users{eventId="event-123"} 1000

# API ìš”ì²­ ì†ë„
tiketi_http_requests_total{method="POST",path="/api/queue/check"} 100000

# API ì‘ë‹µ ì‹œê°„
tiketi_http_request_duration_seconds{path="/api/queue/check",quantile="0.99"} 0.15
```

### CloudWatch ì•ŒëŒ

```yaml
ì•ŒëŒ 1: ëŒ€ê¸°ì—´ í­ì¦
  - Metric: tiketi_queue_size
  - Threshold: > 10,000
  - Action: Discord ì•Œë¦¼ + HPA ê°•ì œ ìŠ¤ì¼€ì¼ ì•„ì›ƒ

ì•ŒëŒ 2: API ì§€ì—°
  - Metric: tiketi_http_request_duration_seconds
  - Threshold: > 1ì´ˆ
  - Action: Discord ì•Œë¦¼

ì•ŒëŒ 3: Pod CPU ê³¼ë¶€í•˜
  - Metric: container_cpu_usage
  - Threshold: > 80%
  - Action: HPA ìë™ íŠ¸ë¦¬ê±°
```

---

## 8. ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼ (ì˜ˆìƒ)

### í…ŒìŠ¤íŠ¸ í™˜ê²½
```bash
node scripts/queue-load-test.js --users 1000 --eventId {uuid}
```

### ì˜ˆìƒ ê²°ê³¼

#### 1,000ëª… ë™ì‹œ ì ‘ì†
```
ğŸ“Š Test Results
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â±ï¸  Duration: 12.5s
ğŸ‘¥ Total Users: 1000
âœ… Allowed Immediately: 1000
â³ Queued: 0
âŒ Errors: 0
ğŸ“ Avg Queue Position: N/A
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

#### 5,000ëª… ë™ì‹œ ì ‘ì†
```
ğŸ“Š Test Results
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â±ï¸  Duration: 18.2s
ğŸ‘¥ Total Users: 5000
âœ… Allowed Immediately: 1000
â³ Queued: 4000
âŒ Errors: 0
ğŸ“ Avg Queue Position: 2000
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

#### 10,000ëª… ë™ì‹œ ì ‘ì†
```
ğŸ“Š Test Results
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â±ï¸  Duration: 25.8s
ğŸ‘¥ Total Users: 10000
âœ… Allowed Immediately: 1000
â³ Queued: 9000
âŒ Errors: 0
ğŸ“ Avg Queue Position: 4500
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 9. ìµœì¢… ê¶Œì¥ ì„¤ì • (ëŒ€ê·œëª¨ íŠ¸ë˜í”½)

### í™˜ê²½ë³€ìˆ˜ (Production)
```yaml
# Queue ì„¤ì •
QUEUE_THRESHOLD: 2000              # 1000 â†’ 2000 (2ë°°)
QUEUE_PROCESSOR_INTERVAL: 5000    # 10ì´ˆ â†’ 5ì´ˆ (2ë°° ë¹ ë¦„)
QUEUE_IDLE_TIMEOUT_MS: 60000      # 90ì´ˆ â†’ 60ì´ˆ (ë¹ ë¥¸ íšŒì „)

# Redis
REDIS_HOST: tiketi-redis-multiaz.eaaj6u.ng.0001.apn2.cache.amazonaws.com
REDIS_PORT: 6379

# Connection Pool
DB_POOL_MAX: 200                   # 100 â†’ 200
DB_POOL_MIN: 20                    # 10 â†’ 20
```

### HPA ì„¤ì •
```yaml
minReplicas: 5
maxReplicas: 20
targetCPUUtilization: 60%  # 70% â†’ 60% (ë” ë¹¨ë¦¬ ìŠ¤ì¼€ì¼ ì•„ì›ƒ)
```

### ALB ì„¤ì •
```yaml
# Connection Settings
Idle Timeout: 60ì´ˆ
Deregistration Delay: 30ì´ˆ
Connection Draining: í™œì„±í™”
```

---

## 10. íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ

### ë¬¸ì œ: ëŒ€ê¸°ì—´ì´ ê³„ì† ëŠ˜ì–´ë‚¨

**ì¦ìƒ**:
```
ëŒ€ê¸°ì—´: 10,000 â†’ 15,000 â†’ 20,000 (ê³„ì† ì¦ê°€)
```

**ì›ì¸**:
- Queue Processorê°€ ë™ì‘í•˜ì§€ ì•ŠìŒ
- ë˜ëŠ” ì²˜ë¦¬ ì†ë„ < ìœ ì… ì†ë„

**í•´ê²°**:
```bash
# 1. Queue Processor ì‹¤í–‰ í™•ì¸
kubectl logs -n tiketi -l app=ticket-service | grep "Queue processor"

# 2. Redis ì—°ê²° í™•ì¸
kubectl exec -n tiketi ticket-service-xxx -- redis-cli -h $REDIS_HOST PING

# 3. ìˆ˜ë™ìœ¼ë¡œ ëŒ€ê¸°ì—´ ì²˜ë¦¬
# (Admin API í˜¸ì¶œ ë˜ëŠ” Queue Processor ì¬ì‹œì‘)
```

### ë¬¸ì œ: Socket.IO ì—°ê²° ëŠê¹€

**ì¦ìƒ**:
```
ì‚¬ìš©ì: "ì—°ê²° ëŠê¹€" ë©”ì‹œì§€ í‘œì‹œ
```

**ì›ì¸**:
- ALB Idle Timeout (60ì´ˆ)
- WebSocket ì—°ê²° ìœ ì§€ ì‹¤íŒ¨

**í•´ê²°**:
```javascript
// í´ë¼ì´ì–¸íŠ¸ì—ì„œ Heartbeat ì „ì†¡
setInterval(() => {
  socket.emit('heartbeat');
}, 30000);  // 30ì´ˆë§ˆë‹¤

// ì„œë²„ì—ì„œ ì‘ë‹µ
socket.on('heartbeat', () => {
  socket.emit('heartbeat-ack');
});
```

### ë¬¸ì œ: Podê°€ CrashLoopBackOff

**ì¦ìƒ**:
```bash
kubectl get pods -n tiketi
NAME                              READY   STATUS             RESTARTS
ticket-service-xxx                0/1     CrashLoopBackOff   5
```

**ì›ì¸**:
- Redis ì—°ê²° ì‹¤íŒ¨
- ë©”ëª¨ë¦¬ ë¶€ì¡±
- í™˜ê²½ë³€ìˆ˜ ëˆ„ë½

**í•´ê²°**:
```bash
# ë¡œê·¸ í™•ì¸
kubectl logs -n tiketi ticket-service-xxx

# Redis ì—°ê²° í…ŒìŠ¤íŠ¸
kubectl exec -n tiketi ticket-service-xxx -- env | grep REDIS

# ë¦¬ì†ŒìŠ¤ í™•ì¸
kubectl top pods -n tiketi
```

---

## ê²°ë¡ 

### í•µì‹¬ í¬ì¸íŠ¸

1. **ALBëŠ” íŠ¸ë˜í”½ ë¶„ì‚°ì˜ í•µì‹¬**
   - ìë™ ìŠ¤ì¼€ì¼ë§ìœ¼ë¡œ ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ì²˜ë¦¬
   - Health Checkë¡œ ì¥ì•  Pod ìë™ ì œì™¸
   - Connection Poolingìœ¼ë¡œ íš¨ìœ¨ì  ì—°ê²° ê´€ë¦¬

2. **ëŒ€ê¸°ì—´ì€ ê³µì •ì„±ê³¼ ì•ˆì •ì„±ì˜ í•µì‹¬**
   - Redis FIFOë¡œ ì„ ì°©ìˆœ ë³´ì¥
   - Queue Processorë¡œ ìë™ ì…ì¥ ì²˜ë¦¬
   - Socket.IOë¡œ ì‹¤ì‹œê°„ ì•Œë¦¼

3. **Multi-Pod + Redis = í™•ì¥ì„±**
   - Pod ì¦ê°€ â†’ ì²˜ë¦¬ ëŠ¥ë ¥ ì„ í˜• ì¦ê°€
   - Redis Pub/Subë¡œ ë™ê¸°í™”
   - HPAë¡œ ìë™ ìŠ¤ì¼€ì¼ë§

4. **ë³‘ëª©ì€ DB, Redis ì•„ë‹˜**
   - PostgreSQL Connection Pool ì¦ê°€
   - ì¢Œì„ ì •ë³´ Redis ìºì‹±
   - Read Replica í™œìš©

### 100,000ëª… ë™ì‹œ ì ‘ì† ì²˜ë¦¬ ëŠ¥ë ¥

**í˜„ì¬ ì„¤ì •**:
- âš ï¸ 2.75ì‹œê°„ ì†Œìš” (ëŠë¦¼)

**ìµœì í™” í›„**:
- âœ… 16ë¶„ ì†Œìš” (OK)
- âœ… HPA + ë™ì  ì„ê³„ê°’ + ë¹ ë¥¸ Processor

**ì‹¤ì œ í‹°ì¼“íŒ…**:
- í‹°ì¼“ì€ 5ë¶„ ë‚´ ì™„íŒ
- 99,000ëª…ì€ ì¢Œì„ ì—†ìŒ (ëŒ€ê¸°ì—´ë§Œ ê²½í—˜)
- ì¤‘ìš”í•œ ê±´ ì²˜ìŒ 1,000~2,000ëª…ì˜ ê²½í—˜!

---

**ì‘ì„±**: Claude Sonnet 4.5
**ë‚ ì§œ**: 2026-01-08
