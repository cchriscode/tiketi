# CRITICAL: Staging Sealed Secrets
# This is a PLACEHOLDER for actual encrypted secrets
#
# To create real SealedSecrets for staging:
#
# 1. Install Sealed Secrets Controller in EKS cluster:
#    kubectl apply -f https://github.com/bitnami-labs/sealed-secrets/releases/download/v0.24.0/controller.yaml
#
# 2. Get the public key from the controller:
#    kubeseal --fetch-cert --controller-name=sealed-secrets-controller --controller-namespace=kube-system > pub-cert.pem
#
# 3. Generate strong secrets:
#    export DB_PASSWORD=$(openssl rand -base64 32)
#    export JWT_SECRET=$(openssl rand -base64 32)
#    export ADMIN_PASSWORD=$(openssl rand -base64 32)
#    export INTERNAL_API_TOKEN=$(openssl rand -base64 32)
#
# 4. Create plain Secret:
#    kubectl create secret generic tiketi-secret \
#      --from-literal=DB_PASSWORD="$DB_PASSWORD" \
#      --from-literal=JWT_SECRET="$JWT_SECRET" \
#      --from-literal=ADMIN_PASSWORD="$ADMIN_PASSWORD" \
#      --from-literal=INTERNAL_API_TOKEN="$INTERNAL_API_TOKEN" \
#      --namespace=tiketi-staging \
#      --dry-run=client -o yaml > plain-secret.yaml
#
# 5. Encrypt with kubeseal:
#    kubeseal --format=yaml --cert=pub-cert.pem \
#      < plain-secret.yaml > k8s/overlays/staging/secrets.enc.yaml
#
# 6. Delete plain secret:
#    rm plain-secret.yaml
#
# 7. Commit encrypted secret to Git:
#    git add k8s/overlays/staging/secrets.enc.yaml
#    git commit -m "feat(k8s): add encrypted staging secrets"
#
# WARNING: This PLACEHOLDER will cause pods to fail. Replace before deployment!
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: tiketi-secret
  namespace: tiketi-staging
spec:
  # encryptedData contains the encrypted values
  # These are PLACEHOLDER values - MUST be replaced with actual encrypted data
  encryptedData:
    # Run: echo -n "your-actual-password" | kubeseal --raw --name=tiketi-secret --namespace=tiketi-staging --cert=pub-cert.pem
    DB_PASSWORD: AgBQRVBMQUNFSE9MREVSX0VOQ1JZUFRFRF9EQVRBLi4uCg==
    JWT_SECRET: AgBQRVBMQUNFSE9MREVSX0VOQ1JZUFRFRF9EQVRBLi4uCg==
    ADMIN_PASSWORD: AgBQRVBMQUNFSE9MREVSX0VOQ1JZUFRFRF9EQVRBLi4uCg==
    INTERNAL_API_TOKEN: AgBQRVBMQUNFSE9MREVSX0VOQ1JZUFRFRF9EQVRBLi4uCg==

  # template defines the Secret that will be created after decryption
  template:
    metadata:
      name: tiketi-secret
      namespace: tiketi-staging
      labels:
        app.kubernetes.io/part-of: tiketi
        environment: staging
    type: Opaque
