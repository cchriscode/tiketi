apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: tiketi

resources:
  - namespace.yaml     # Production namespace (tiketi)
  - ../../base
  - ingress.yaml
  - hpa.yaml
  - pdb.yaml
  # - secrets.enc.yaml  # SealedSecret for production (TODO: Install Sealed Secrets Controller first)

configMapGenerator:
  - name: tiketi-config
    literals:
      - NODE_ENV=production
      # RDS PostgreSQL endpoints (actual production endpoint)
      - DB_HOST=tiketiadv-dev-rds.cjiiqeo2ou62.ap-northeast-2.rds.amazonaws.com
      - DB_PORT=5432
      - DB_NAME=tiketi
      - DB_USER=tiketi_user
      - DB_SSL=true
      # ElastiCache Redis Multi-AZ (ap-northeast-2a, 2b) - same AZs as EKS nodes
      # No TLS, reads from same-AZ replica for < 1ms latency
      - REDIS_HOST=tiketi-redis-multiaz.eaaj6u.ng.0001.apn2.cache.amazonaws.com
      - REDIS_PORT=6379
      # Service URLs (ClusterIP internal communication)
      - PORT=3001
      - SOCKET_IO_CORS_ORIGIN=https://tiketi.store,https://www.tiketi.store,https://tiketi.com,https://www.tiketi.com
      - TZ=Asia/Seoul
      # Frontend will be on S3+CloudFront
      - AWS_REGION=ap-northeast-2
      - AWS_S3_BUCKET=tiketi-prod-assets
      - GOOGLE_CLIENT_ID=721028631258-dhjgd4gquphib49fsoitiubusbo3t9e9.apps.googleusercontent.com
      # TossPayments integration
      - TOSS_CLIENT_KEY=test_ck_EP59LybZ8BlAdL6Z1o4ZV6GYo7pR

patches:
  - path: resource-patches.yaml

images:
  - name: tiketi-backend
    newName: 640740721346.dkr.ecr.ap-northeast-2.amazonaws.com/tiketi-backend
    newTag: d0f2362-20260107-175411
  - name: tiketi-auth-service
    newName: 640740721346.dkr.ecr.ap-northeast-2.amazonaws.com/tiketi/auth
    newTag: 3f44d16-20260107-143845
  - name: tiketi-ticket-service
    newName: 640740721346.dkr.ecr.ap-northeast-2.amazonaws.com/tiketi/ticket
    newTag: beed6fa-20260107-172002
  - name: tiketi-payment-service
    newName: 640740721346.dkr.ecr.ap-northeast-2.amazonaws.com/tiketi/payment
    newTag: 5d9a8c6-20260107-174745
  - name: tiketi-stats-service
    newName: 640740721346.dkr.ecr.ap-northeast-2.amazonaws.com/tiketi/stats
    newTag: 15c646f-20260107-174051

commonLabels:
  environment: production
