apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: tiketi

resources:
  - namespace.yaml     # Production namespace (tiketi)
  - ../../base
  - ingress.yaml
  - hpa.yaml
  - pdb.yaml
  # - secrets.enc.yaml  # SealedSecret for production (TODO: Install Sealed Secrets Controller first)

configMapGenerator:
  - name: tiketi-config
    literals:
      - NODE_ENV=production
      # RDS PostgreSQL endpoints (actual production endpoint)
      - DB_HOST=tiketiadv-dev-rds.cjiiqeo2ou62.ap-northeast-2.rds.amazonaws.com
      - DB_PORT=5432
      - DB_NAME=tiketi
      - DB_USER=tiketi_user
      - DB_SSL=true
      # ElastiCache Redis endpoints (DISABLED due to 2s+ latency causing 4s event loading)
      # ElastiCache Cross-AZ latency (2a/2b) + TLS overhead causes timeouts
      # Queue/Socket.IO features will degrade gracefully without Redis
      - REDIS_HOST=localhost
      - REDIS_PORT=6379
      # Service URLs (ClusterIP internal communication)
      - PORT=3001
      - SOCKET_IO_CORS_ORIGIN=https://tiketi.com,https://www.tiketi.com
      - TZ=Asia/Seoul
      # Frontend will be on S3+CloudFront
      - AWS_REGION=ap-northeast-2
      - AWS_S3_BUCKET=tiketi-prod-assets
      - GOOGLE_CLIENT_ID=721028631258-dhjgd4gquphib49fsoitiubusbo3t9e9.apps.googleusercontent.com

patches:
  - path: resource-patches.yaml

images:
  - name: tiketi-backend
    newName: 640740721346.dkr.ecr.ap-northeast-2.amazonaws.com/tiketi-backend
    newTag: latest
  - name: tiketi-auth-service
    newName: 640740721346.dkr.ecr.ap-northeast-2.amazonaws.com/tiketi/auth
    newTag: latest
  - name: tiketi-ticket-service
    newName: 640740721346.dkr.ecr.ap-northeast-2.amazonaws.com/tiketi/ticket
    newTag: latest
  - name: tiketi-payment-service
    newName: 640740721346.dkr.ecr.ap-northeast-2.amazonaws.com/tiketi/payment
    newTag: latest
  - name: tiketi-stats-service
    newName: 640740721346.dkr.ecr.ap-northeast-2.amazonaws.com/tiketi/stats
    newTag: latest

commonLabels:
  environment: production
