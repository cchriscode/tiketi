# 4팀: 티켓팅 예약관리 플랫폼 "티케티(Tiketi)"


### 프로젝트 설명
티케티(Tiketi)는 대규모 동시접속을 처리할 수 있는 클라우드 네이티브 티켓팅 플랫폼입니다. 서버가 가장 취약해지기 쉬운 티켓팅 플랫폼 특성상 티켓 오픈 시간 등 특정 시간대에 트래픽이 엄청나게 몰리는 상황을 성공적으로 처리할 수 있는 아키텍처를 구축하는것이 목표입니다.

### 주요 요구사항
- **성능**: 10,000명 동시접속, 1,000 TPS 처리
- **가용성**: 99.9% SLA, 무중단 배포
- **확장성**: 자동 스케일링으로 30초 내 확장
- **사용자 경험**: 실시간 대기열 순번 표시, 200ms 이하 응답속도
- **결제**: 토스페이먼츠 연동 모의 결제 프로세스

### 기술적 제약사항
- AWS EKS 기반 Kubernetes 환경 필수
- MSA 4개 서비스 분리 (Auth, Ticket, Payment, Stats)
- GitOps(ArgoCD) 기반 배포
- Istio Service Mesh 도입
- Redis 기반 대기열 시스템

## 아키텍처 설계 의도
### 1. CI/CD 파이프라인
**설계 근거**: 
- GitHub Actions + ArgoCD 조합으로 GitOps 구현
- 5단계 파이프라인으로 품질 게이트 강화
- Blue/Green, Canary 배포로 리스크 최소화

**기술 선택 이유**:
- **GitHub Actions**: 코드 저장소와 통합된 CI
- **ArgoCD**: K8s 네이티브 GitOps 도구

### 2. AWS 아키텍처

**설계 근거**:
- Multi-AZ 구성으로 고가용성 확보
- EKS로 컨테이너 오케스트레이션
- Edge Services로 DDoS 방어 및 성능 최적화

**기술 선택 이유**:
- **EKS (Elastic Kubernetes Service)**: 
  - AWS 관리형으로 Control Plane 운영 부담 제거
  - Auto Scaling Group과 네이티브 통합으로 노드 자동 확장
  - IAM, VPC, ALB 등 AWS 서비스와 완벽한 통합
  - Fargate 옵션으로 서버리스 컨테이너 실행 가능

- **RDS PostgreSQL Multi-AZ**: 
  - ACID 특성으로 결제 트랜잭션 무결성 보장
  - 자동 failover로 1분 이내 복구 (RPO 1분 달성)
  - Point-in-Time Recovery로 데이터 복원 가능
  - Read Replica로 읽기 부하 분산

- **ElastiCache Redis 클러스터**: 
  - Sorted Set으로 대기열 순번 관리 최적화
  - 인메모리 처리로 μs 단위 응답속도
  - 클러스터 모드로 10,000명 동시 대기 처리
  - Session Store로 스티키 세션 불필요

- **CloudFront + WAF**:
  - 엣지 로케이션에서 정적 콘텐츠 캐싱
  - WAF 규칙으로 봇/DDoS 공격 차단
  - 오리진 부하 80% 감소 효과

### 3. VPC 네트워크
**설계 근거**:
- 3-Tier 서브넷 분리로 보안 강화
- 각 AZ별 NAT Gateway로 단일 장애점 제거
- 세밀한 Security Group 정책

**기술 선택 이유**:
- **VPC (10.0.0.0/16)**:
  - 65,536개 IP로 대규모 확장 여유 확보
  - Private IP 대역으로 내부 통신 보안
  - VPC Peering/Transit Gateway 확장 가능
  - Flow Logs로 네트워크 트래픽 감사

- **3-Tier 서브넷 아키텍처**:
  - Public Subnet: ALB만 배치하여 공격 표면 최소화
  - Private Subnet: EKS 워커 노드 격리로 직접 접근 차단
  - DB Subnet: RDS 전용 격리망으로 데이터 보안 극대화
  - 서브넷별 /24 CIDR로 254개 호스트 수용

- **이중화된 NAT Gateway**:
  - 각 AZ별 독립 NAT로 Cross-AZ 트래픽 비용 절감
  - AZ 장애 시에도 다른 AZ 정상 운영
  - 최대 45Gbps 처리량으로 버스트 트래픽 대응
  - Elastic IP로 화이트리스트 관리 용이

- **Security Group 계층 방어**:
  - ALB SG: 80/443 포트만 개방
  - EKS SG: ALB로부터만 인바운드 허용
  - RDS SG: EKS 노드로부터만 5432 포트 허용
  - Stateful 방화벽으로 리턴 트래픽 자동 허용

**트레이드오프**:
- NAT Gateway 이중화 → 월 $90 추가 비용 vs 가용성 향상
- DB 서브넷 분리 → 복잡도 증가 vs 규정 준수 및 보안 강화


### 4. 마이크로서비스
**설계 근거**:
- 도메인별 서비스 분리로 독립적 확장
- Queue를 Ticket Service 내부 모듈로 구현 (필요시 분리)
- Istio로 서비스 간 통신 보안 및 관찰가능성 확보

**기술 선택 이유**:
- **Istio Service Mesh**:
   - Envoy 프록시로 모든 서비스 간 mTLS 자동 암호화
   - Circuit Breaker로 장애 서비스 자동 격리 (50% 에러율 시 차단)
   - Distributed Tracing으로 요청 흐름 추적 (Jaeger 연동)
   - 카나리 배포 시 트래픽 비율 세밀 제어 (1% → 10% → 50% → 100%)
   - Rate Limiting으로 서비스별 요청 제한
   
- **Service별 독립 DB**: 
   - 서비스 자율성 보장 및 장애 격리
   - 도메인별 최적화된 DB 선택 가능
    
- **Redis/RabbitMQ**: 
   - Redis: 세션 관리 및 실시간 대기열 처리
   - RabbitMQ: 메시지 큐를 통한 비동기 통신으로 서비스 결합도 감소


### 5. 비즈니스 로직
**설계 근거**:
- 대기열 시스템으로 트래픽 평준화
- WebSocket으로 실시간 사용자 경험 제공
- 좌석 점유 시간제한으로 공정성 확보

**기술 선택 이유**:
- **Redis 기반 대기열 시스템**:
  - Sorted Set으로 O(log n) 시간복잡도로 순번 관리
  - 원자적 연산으로 동시성 문제 해결
  - TTL 설정으로 유령 사용자 자동 제거
  - 10,000명 동시 대기 시에도 ms 단위 응답

- **WebSocket 실시간 통신**:
  - 폴링 대비 서버 부하 90% 감소
  - 양방향 통신으로 즉각적인 순번 업데이트
  - 재연결 메커니즘으로 네트워크 불안정 대응
  - Socket.IO로 브라우저 호환성 보장

- **좌석 점유 로직**:
  - 10분 시간제한으로 좌석 회전율 향상
  - 분산 락(Redis)으로 중복 점유 방지
  - 트랜잭션으로 결제-예매 원자성 보장
  - 점유 실패 시 즉시 대기열 재진입

- **토스페이먼츠 샌드박스 연동**:
  - 테스트 결제로 실제 결제 플로우 검증
  - Webhook으로 결제 상태 실시간 동기화
  - 결제 실패 시나리오 테스트 가능
  - 실제 서비스 전환 시 최소 코드 변경

**트레이드오프**:
- 대기열 시스템 → UX 복잡도 증가 vs 시스템 안정성 확보
- 실시간 알림 → WebSocket 연결 유지 비용 vs 사용자 만족도
- 시간제한 → 일부 사용자 불만 vs 전체 공정성 향상



### 6. 모니터링
**설계 근거**:
- 4-Layer 모니터링 (인프라/앱/비즈니스/서비스메시)
- SLA/SLO 기반 알림 설정
- 통합 대시보드로 운영 효율성 향상

**기술 선택 이유**:
- **Prometheus (메트릭 수집)**:
  - Kubernetes 네이티브 Service Discovery
  - Pull 방식으로 대상 서비스 부하 최소화
  - PromQL로 복잡한 쿼리 및 집계 가능
  - 15초 주기 스크래핑으로 실시간 모니터링
  - TSDB로 시계열 데이터 효율적 저장

- **Loki (로그 수집)**:
  - 메타데이터만 인덱싱하여 비용 90% 절감
  - Prometheus와 동일한 라벨 체계로 통합 쿼리
  - LogQL로 분산 로그 실시간 검색
  - S3 백엔드로 장기 보관 및 비용 최적화

- **Grafana (시각화)**:
  - 다중 데이터소스 통합 대시보드
  - Alert Manager 연동으로 단일 알림 창구
  - 역할 기반 접근 제어로 보안 강화
  - 임베디드 대시보드로 개발자 셀프서비스

- **Istio Telemetry (서비스메시)**:
  - Jaeger로 분산 트레이싱 자동 수집
  - 서비스 간 레이턴시 및 에러율 추적
  - mTLS 인증서 만료 모니터링
  - Circuit Breaker 작동 현황 실시간 확인

- **CloudWatch 통합**:
  - EKS 클러스터 및 노드 상태 모니터링
  - RDS/ElastiCache 성능 메트릭 수집
  - AWS 비용 및 사용량 추적
  - 네이티브 알림으로 인프라 이슈 대응


## 사용 도구

### 다이어그램 작성 도구
- **draw.io**: 모든 다이어그램 작성
  - 선택 이유: AWS 아이콘 지원, 무료, 세부수정 용이


### 팀 협업 방식
- **GitHub**: 버전 관리 및 코드 리뷰
- **Discord**: 실시간 커뮤니케이션
- **Notion**: 문서화 및 지식 공유
#### * 설계 프로세스
1. 요구사항 분석 → 아키텍처 초안 작성
2. 팀원 리뷰 → 피드백 반영
3. 상세 설계 → 다이어그램 작성
4. 최종 검토 → 문서화