<mxfile host="app.diagrams.net"><diagram name="02) Platform Inner (Kubernetes Object View)" id="02-platform-inner-kubernetes-object-view"><mxGraphModel dx="2000" dy="1200" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2000" pageHeight="1200" math="0" shadow="0"><root><mxCell id="0" /><mxCell id="1" parent="0" /><mxCell id="v-2" value="Tiketi - Platform Inner (Kubernetes Object View / EKS)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;;fontSize=24;fontStyle=1" vertex="1" parent="1"><mxGeometry x="600" y="20" width="800" height="40" as="geometry" /></mxCell><mxCell id="v-3" value="EKS Cluster: tiketi-&lt;env&gt; (ap-northeast-2) | endpoint: private-access=true, public=false" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#666666;dashed=1;" vertex="1" parent="1"><mxGeometry x="60" y="90" width="1880" height="1050" as="geometry" /></mxCell><mxCell id="v-4" value="NodeGroup: app (label: nodegroup=app)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6F2F8;strokeColor=#147EBA;" vertex="1" parent="1"><mxGeometry x="90" y="140" width="900" height="380" as="geometry" /></mxCell><mxCell id="v-5" value="NodeGroup: observability (label: nodegroup=observability)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FCE7F3;strokeColor=#BC1356;" vertex="1" parent="1"><mxGeometry x="1040" y="140" width="900" height="380" as="geometry" /></mxCell><mxCell id="v-6" value="Namespace: kube-system" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3F4F6;strokeColor=#6B7280;" vertex="1" parent="1"><mxGeometry x="90" y="540" width="560" height="580" as="geometry" /></mxCell><mxCell id="v-7" value="ServiceAccount\naws-load-balancer-controller\nannotation: eks.amazonaws.com/role-arn = (eks-irsa output)\naws_load_balancer_controller_role_arn" style="rounded=1;whiteSpace=wrap;html=1;fillColor=white;strokeColor=#6B7280;fontSize=11;" vertex="1" parent="1"><mxGeometry x="110" y="600" width="520" height="90" as="geometry" /></mxCell><mxCell id="v-8" value="Deployment\naws-load-balancer-controller" style="rounded=1;whiteSpace=wrap;html=1;fillColor=white;strokeColor=#6B7280;fontSize=11;" vertex="1" parent="1"><mxGeometry x="110" y="710" width="520" height="70" as="geometry" /></mxCell><mxCell id="v-9" value="ServiceAccount\nexternal-dns\nannotation: eks.amazonaws.com/role-arn = (eks-irsa output)\nexternal_dns_role_arn" style="rounded=1;whiteSpace=wrap;html=1;fillColor=white;strokeColor=#6B7280;fontSize=11;" vertex="1" parent="1"><mxGeometry x="110" y="800" width="520" height="90" as="geometry" /></mxCell><mxCell id="v-10" value="Deployment\nexternal-dns" style="rounded=1;whiteSpace=wrap;html=1;fillColor=white;strokeColor=#6B7280;fontSize=11;" vertex="1" parent="1"><mxGeometry x="110" y="910" width="520" height="70" as="geometry" /></mxCell><mxCell id="v-11" value="Deployment\naws-ebs-csi-driver\nSA: ebs-csi-controller-sa (IRSA)\noutput: ebs_csi_role_arn" style="rounded=1;whiteSpace=wrap;html=1;fillColor=white;strokeColor=#6B7280;fontSize=11;" vertex="1" parent="1"><mxGeometry x="110" y="1000" width="520" height="90" as="geometry" /></mxCell><mxCell id="v-12" value="Namespace: app" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6F2F8;strokeColor=#147EBA;" vertex="1" parent="1"><mxGeometry x="110" y="190" width="860" height="310" as="geometry" /></mxCell><mxCell id="v-13" value="Ingress backend\n(ingressClassName: alb)\nannotations:\n- scheme=internet-facing\n- target-type=ip\n- certificate-arn=(edge output) alb_certificate_arn\n- healthcheck-path=/health\n- external-dns hostname=api.&lt;domain&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=white;strokeColor=#147EBA;fontSize=11;" vertex="1" parent="1"><mxGeometry x="130" y="240" width="360" height="160" as="geometry" /></mxCell><mxCell id="v-14" value="Service backend (ClusterIP)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=white;strokeColor=#147EBA;" vertex="1" parent="1"><mxGeometry x="510" y="240" width="180" height="60" as="geometry" /></mxCell><mxCell id="v-15" value="Deployment backend\nnodeSelector: nodegroup=app\nHPA + PDB" style="rounded=1;whiteSpace=wrap;html=1;fillColor=white;strokeColor=#147EBA;fontSize=11;" vertex="1" parent="1"><mxGeometry x="510" y="320" width="220" height="80" as="geometry" /></mxCell><mxCell id="v-16" value="Pods xN" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#EFF6FF;strokeColor=#147EBA;" vertex="1" parent="1"><mxGeometry x="750" y="320" width="200" height="80" as="geometry" /></mxCell><mxCell id="v-17" value="ConfigMap" style="rounded=1;whiteSpace=wrap;html=1;fillColor=white;strokeColor=#147EBA;" vertex="1" parent="1"><mxGeometry x="720" y="240" width="110" height="60" as="geometry" /></mxCell><mxCell id="v-18" value="Secret\n(source: SecretsManager via ExternalSecret - optional)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=white;strokeColor=#147EBA;fontSize=10;" vertex="1" parent="1"><mxGeometry x="840" y="240" width="110" height="60" as="geometry" /></mxCell><mxCell id="v-19" value="ServiceAccount backend\n(TODO if app needs AWS API)\nannotation: eks.amazonaws.com/role-arn" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff7ed;strokeColor=#d97706;dashed=1;fontSize=10;" vertex="1" parent="1"><mxGeometry x="510" y="410" width="440" height="60" as="geometry" /></mxCell><mxCell id="v-20" value="Namespace: observability" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FCE7F3;strokeColor=#BC1356;" vertex="1" parent="1"><mxGeometry x="1060" y="190" width="860" height="310" as="geometry" /></mxCell><mxCell id="v-21" value="Prometheus (kube-prometheus-stack)\nnodeSelector: nodegroup=observability" style="rounded=1;whiteSpace=wrap;html=1;fillColor=white;strokeColor=#BC1356;fontSize=11;" vertex="1" parent="1"><mxGeometry x="1080" y="240" width="360" height="70" as="geometry" /></mxCell><mxCell id="v-22" value="ServiceMonitor backend" style="rounded=1;whiteSpace=wrap;html=1;fillColor=white;strokeColor=#BC1356;" vertex="1" parent="1"><mxGeometry x="1080" y="330" width="360" height="60" as="geometry" /></mxCell><mxCell id="v-23" value="Grafana" style="rounded=1;whiteSpace=wrap;html=1;fillColor=white;strokeColor=#BC1356;" vertex="1" parent="1"><mxGeometry x="1460" y="240" width="440" height="70" as="geometry" /></mxCell><mxCell id="v-24" value="Loki" style="rounded=1;whiteSpace=wrap;html=1;fillColor=white;strokeColor=#BC1356;" vertex="1" parent="1"><mxGeometry x="1460" y="330" width="440" height="60" as="geometry" /></mxCell><mxCell id="v-25" value="Promtail DaemonSet\n(nodeSelector: nodegroup=observability)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=white;strokeColor=#BC1356;fontSize=11;" vertex="1" parent="1"><mxGeometry x="1080" y="410" width="820" height="70" as="geometry" /></mxCell><mxCell id="v-26" value="ALB" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#8C4FFF;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.application_load_balancer;spacingLeft=0;fontFamily=Helvetica;" vertex="1" parent="1"><mxGeometry x="720" y="540" width="78" height="78" as="geometry" /></mxCell><mxCell id="v-27" value="ECR" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;fillColor=#D05C17;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.ecr;" vertex="1" parent="1"><mxGeometry x="820" y="540" width="78" height="78" as="geometry" /></mxCell><mxCell id="v-28" value="RDS" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;fillColor=#C925D1;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.rds;" vertex="1" parent="1"><mxGeometry x="920" y="540" width="78" height="78" as="geometry" /></mxCell><mxCell id="v-29" value="ElastiCache" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;fillColor=#C925D1;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.elasticache;" vertex="1" parent="1"><mxGeometry x="1020" y="540" width="78" height="78" as="geometry" /></mxCell><mxCell id="v-30" value="Secrets Manager" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;fillColor=#DD344C;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.secrets_manager;" vertex="1" parent="1"><mxGeometry x="1120" y="540" width="78" height="78" as="geometry" /></mxCell><mxCell id="e-31" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="v-13" target="v-14"><mxGeometry relative="1" as="geometry" /></mxCell><mxCell id="e-32" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="v-14" target="v-15"><mxGeometry relative="1" as="geometry" /></mxCell><mxCell id="e-33" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="v-15" target="v-16"><mxGeometry relative="1" as="geometry" /></mxCell><mxCell id="e-34" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;;dashed=1" edge="1" parent="1" source="v-17" target="v-15"><mxGeometry relative="1" as="geometry" /></mxCell><mxCell id="e-35" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;;dashed=1" edge="1" parent="1" source="v-18" target="v-15"><mxGeometry relative="1" as="geometry" /></mxCell><mxCell id="e-36" value="bind (optional)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;;dashed=1" edge="1" parent="1" source="v-19" target="v-16"><mxGeometry relative="1" as="geometry" /></mxCell><mxCell id="e-37" value="scrape" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;;dashed=1" edge="1" parent="1" source="v-22" target="v-21"><mxGeometry relative="1" as="geometry" /></mxCell><mxCell id="e-38" value="query" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="v-21" target="v-23"><mxGeometry relative="1" as="geometry" /></mxCell><mxCell id="e-39" value="push" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;;dashed=1" edge="1" parent="1" source="v-25" target="v-24"><mxGeometry relative="1" as="geometry" /></mxCell><mxCell id="e-40" value="query" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="v-24" target="v-23"><mxGeometry relative="1" as="geometry" /></mxCell><mxCell id="e-41" value="bind" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;;dashed=1" edge="1" parent="1" source="v-7" target="v-8"><mxGeometry relative="1" as="geometry" /></mxCell><mxCell id="e-42" value="bind" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;;dashed=1" edge="1" parent="1" source="v-9" target="v-10"><mxGeometry relative="1" as="geometry" /></mxCell><mxCell id="e-43" value="provision ALB/TG" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;;dashed=1" edge="1" parent="1" source="v-13" target="v-26"><mxGeometry relative="1" as="geometry" /></mxCell><mxCell id="e-44" value="HTTP(S)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="v-26" target="v-14"><mxGeometry relative="1" as="geometry" /></mxCell><mxCell id="e-45" value="pull" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;;dashed=1" edge="1" parent="1" source="v-16" target="v-27"><mxGeometry relative="1" as="geometry" /></mxCell><mxCell id="e-46" value="SQL" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="v-16" target="v-28"><mxGeometry relative="1" as="geometry" /></mxCell><mxCell id="e-47" value="Cache" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="v-16" target="v-29"><mxGeometry relative="1" as="geometry" /></mxCell><mxCell id="e-48" value="(optional) AWS SDK" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;;dashed=1" edge="1" parent="1" source="v-16" target="v-30"><mxGeometry relative="1" as="geometry" /></mxCell><mxCell id="v-49" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;dashed=1;" vertex="1" parent="1"><mxGeometry x="680" y="540" width="1220" height="260" as="geometry" /></mxCell><mxCell id="v-50" value="Legend" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;;fontSize=14;fontStyle=1" vertex="1" parent="1"><mxGeometry x="680" y="546" width="1220" height="24" as="geometry" /></mxCell><mxCell id="v-51" value="&lt;div style='text-align:left;font-size:11px;line-height:1.3'&gt;Accurate mapping to Terraform outputs:&lt;br&gt;- Ingress certificate uses edge output: alb_certificate_arn&lt;br&gt;- Controllers use IRSA roles from eks-irsa outputs&lt;br&gt;Node placement uses labels from terraform: nodegroup=&lt;name&gt;&lt;br&gt;Manifests (EKS): k8s/eks/app/{namespace,backend,hpa,pdb}.yaml&lt;br&gt;Docs:&lt;br&gt;- https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html&lt;br&gt;- https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html&lt;br&gt;- https://docs.aws.amazon.com/eks/latest/userguide/alb-ingress.html&lt;br&gt;- https://docs.aws.amazon.com/eks/latest/best-practices/load-balancing.html&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1"><mxGeometry x="690" y="574" width="1200" height="216" as="geometry" /></mxCell></root></mxGraphModel></diagram></mxfile>