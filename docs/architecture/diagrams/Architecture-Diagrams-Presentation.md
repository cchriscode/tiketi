# TIKETI MSA 아키텍처 다이어그램 - 발표 자료

> **작성일:** 2025-12-03
> **프로젝트:** TIKETI - 실시간 티켓팅 플랫폼
> **목적:** 발표 및 기술 공유용 아키텍처 다이어그램 모음

---

## 목차

1. [클라우드 구성도 (AWS Services)](#1-클라우드-구성도)
2. [소프트웨어 구성도 (Application Architecture)](#2-소프트웨어-구성도)
3. [네트워크 구성도 (VPC & Networking)](#3-네트워크-구성도)
4. [물리/하드웨어 구성도 (Infrastructure)](#4-물리하드웨어-구성도)
5. [운영 및 관리 구성도 (DevOps & Monitoring)](#5-운영-및-관리-구성도)
6. [데이터베이스 구성도 (Data Layer)](#6-데이터베이스-구성도)
7. [보안 구성도 (Security Architecture)](#7-보안-구성도)
8. [마이크로서비스 아키텍처 다이어그램 (MSA)](#8-마이크로서비스-아키텍처-다이어그램)

---

## 1. 클라우드 구성도 (AWS Services)

### 📊 사용 중인 AWS 서비스 전체 맵

```
┌────────────────────────────────────────────────────────────────────────┐
│                          AWS 클라우드 인프라                            │
└────────────────────────────────────────────────────────────────────────┘

┌─────────────────────┐
│  사용자 접속 계층    │
└─────────────────────┘
        │
        ↓
┌────────────────────────────────────────────────────────────────────┐
│ 📍 Route 53 (DNS)                                                  │
│    • 도메인: tiketi.gg                                             │
│    • Health Check                                                  │
└────────────┬───────────────────────────────────────────────────────┘
             │
             ├─────────────────────────────┐
             ↓                             ↓
┌──────────────────────┐        ┌──────────────────────┐
│ 🌐 CloudFront (CDN)  │        │ 🌐 CloudFront (API)  │
│    • 정적 파일 캐싱  │        │    • API 캐싱        │
│    • TTL: 24h        │        │    • TTL: 30s        │
└──────────┬───────────┘        └──────────┬───────────┘
           │                               │
           ↓                               ↓
┌──────────────────────┐        ┌──────────────────────────────┐
│ 📦 S3 Bucket         │        │ ⚖️  Application LB (ALB)     │
│    • React SPA       │        │    • SSL 터미네이션          │
│    • 이미지 저장     │        │    • Path 기반 라우팅        │
│    • Versioning      │        │    • Health Check            │
└──────────────────────┘        └──────────┬───────────────────┘
                                           │
                        ┌──────────────────┼──────────────────┐
                        ↓                  ↓                  ↓
        ┌───────────────────────────────────────────────────────────┐
        │          🐳 EKS (Kubernetes Control Plane)                │
        │             • AWS 완전 관리형                             │
        │             • Multi-AZ (3 AZ)                            │
        │             • 자동 패치 및 업그레이드                    │
        └───────────────────────┬───────────────────────────────────┘
                                │
        ┌───────────────────────┼───────────────────────────────┐
        ↓                       ↓                               ↓
┌──────────────┐      ┌──────────────┐              ┌──────────────┐
│ 🖥️  EC2      │      │ 🖥️  EC2      │              │ 🖥️  EC2      │
│ Worker Node  │      │ Worker Node  │      ...     │ Worker Node  │
│ (On-Demand)  │      │ (Spot 70%↓) │              │ (Spot 70%↓) │
│              │      │              │              │              │
│ • K8s Pod    │      │ • K8s Pod    │              │ • K8s Pod    │
│ • 서비스 실행│      │ • 서비스 실행│              │ • 서비스 실행│
└──────┬───────┘      └──────┬───────┘              └──────┬───────┘
       │                     │                              │
       └─────────────────────┼──────────────────────────────┘
                             │
            ┌────────────────┼────────────────┐
            ↓                ↓                ↓
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ 💾 RDS Aurora   │  │ 🔴 ElastiCache  │  │ 📊 CloudWatch   │
│   PostgreSQL    │  │    Redis        │  │   • Logs        │
│                 │  │                 │  │   • Metrics     │
│ • Multi-AZ      │  │ • Cluster Mode  │  │   • Alarms      │
│ • Auto Scaling  │  │ • 6 Shards      │  │   • Dashboards  │
│ • Read Replica  │  │ • Failover      │  └─────────────────┘
└─────────────────┘  └─────────────────┘
```

### 📋 AWS 서비스 목록 및 역할

| 카테고리 | 서비스 | 역할 | 비용/월 |
|---------|--------|------|---------|
| **컴퓨팅** | EKS | Kubernetes 관리 | $72 |
| | EC2 (On-Demand) | Worker Node 기본 | $360 |
| | EC2 (Spot) | Worker Node 확장 | $50 |
| **네트워킹** | Route 53 | DNS 관리 | $1 |
| | CloudFront | CDN (정적/API) | $50 |
| | ALB | 로드 밸런싱 | $20 |
| **데이터베이스** | RDS Aurora | PostgreSQL 관리형 | $150 |
| | ElastiCache | Redis Cluster | $50 |
| **스토리지** | S3 | 정적 파일 저장 | $5 |
| **모니터링** | CloudWatch | 로그/메트릭/알림 | $30 |
| | X-Ray | 분산 추적 | $10 |
| **보안** | ACM | SSL 인증서 | 무료 |
| | Secrets Manager | 비밀 키 관리 | $2 |
| | IAM | 권한 관리 | 무료 |
| **CI/CD** | ECR | 컨테이너 레지스트리 | $5 |
| **총 비용** | | | **$805/월** |

---

## 2. 소프트웨어 구성도 (Application Architecture)

### 📦 애플리케이션 레이어 구조

```
┌────────────────────────────────────────────────────────────────────┐
│                        사용자 (브라우저)                            │
└────────────────────────────┬───────────────────────────────────────┘
                             │
                ┌────────────┴────────────┐
                ↓                         ↓
┌───────────────────────────┐   ┌──────────────────────────┐
│  프론트엔드 (SPA)         │   │  WebSocket (실시간)      │
│  React 18                 │   │  Socket.IO               │
│                           │   │                          │
│  • React Router           │   │  • 대기열 순번 업데이트  │
│  • Axios (HTTP)           │   │  • 좌석 상태 동기화      │
│  • Socket.IO Client       │   │  • 재고 실시간 갱신      │
│                           │   │                          │
│  빌드: Vite               │   │  연결: Queue Service     │
│  호스팅: S3 + CloudFront  │   │  프로토콜: WebSocket     │
└───────────────────────────┘   └──────────────────────────┘
                │                         │
                └────────────┬────────────┘
                             ↓
┌────────────────────────────────────────────────────────────────────┐
│                    API Gateway Layer                               │
│  Nginx Ingress Controller (K8s)                                   │
│                                                                    │
│  • Path 기반 라우팅:                                               │
│    /api/v1/auth         → Auth Service                           │
│    /api/v1/events       → Event Service                          │
│    /api/v1/queue        → Queue Service                          │
│    /api/v1/reservations → Reservation Service                    │
│    /api/v1/payments     → Payment Service                        │
│                                                                    │
│  • Rate Limiting                                                   │
│  • CORS 처리                                                       │
│  • SSL/TLS 터미네이션                                             │
└────────────┬───────────────────────────────────────────────────────┘
             │
    ┌────────┼────────┬────────┬────────┬────────┐
    ↓        ↓        ↓        ↓        ↓        ↓
┌────────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────────┐
│Auth    │ │Event │ │Queue │ │Reserv│ │Payment│ │Admin     │
│Service │ │Svc   │ │Svc   │ │Svc   │ │Svc    │ │Service   │
│        │ │      │ │      │ │      │ │       │ │          │
│Node.js │ │Node  │ │Node  │ │Node  │ │Node   │ │Node.js   │
│Express │ │      │ │Socket│ │      │ │       │ │          │
│        │ │      │ │.IO   │ │      │ │       │ │          │
│Port    │ │Port  │ │Port  │ │Port  │ │Port   │ │Port      │
│3010    │ │3011  │ │3012  │ │3013  │ │3014   │ │3015      │
│        │ │      │ │      │ │      │ │       │ │          │
│Pod:2-10│ │Pod:  │ │Pod:  │ │Pod:  │ │Pod:   │ │Pod: 1-2  │
│        │ │2-20  │ │3-100 │ │3-50  │ │2-10   │ │          │
└────┬───┘ └───┬──┘ └───┬──┘ └───┬──┘ └───┬───┘ └────┬─────┘
     │         │        │        │        │          │
     └─────────┴────────┴────────┴────────┴──────────┘
                        │
        ┌───────────────┼───────────────┐
        ↓               ↓               ↓
┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│ PostgreSQL   │ │ Redis        │ │ External API │
│ (RDS Aurora) │ │(ElastiCache) │ │ (토스페이먼츠)│
│              │ │              │ │              │
│ • users      │ │ • queue:*    │ │ • 결제 처리  │
│ • events     │ │ • lock:*     │ │ • 환불       │
│ • reserv     │ │ • cache:*    │ │              │
│ • payments   │ │ • session:*  │ │              │
└──────────────┘ └──────────────┘ └──────────────┘
```

### 🔧 기술 스택 상세

| 레이어 | 기술 | 버전 | 선정 이유 |
|--------|------|------|----------|
| **Frontend** | React | 18.2.0 | 컴포넌트 재사용, 큰 생태계 |
| | React Router | 6.20.1 | SPA 라우팅 표준 |
| | Socket.IO Client | 4.7.2 | 실시간 양방향 통신 |
| | Axios | 1.6.2 | HTTP 클라이언트, 인터셉터 |
| **Backend** | Node.js | 18 LTS | 비동기 I/O, 빠른 개발 |
| | Express | 4.18.2 | 경량 프레임워크 |
| | Socket.IO | 4.7.2 | WebSocket 추상화 |
| **Database** | PostgreSQL | 15 | ACID 트랜잭션, 안정성 |
| | Redis | 7.0 | 캐싱, 분산 락, 세션 |
| **Container** | Docker | 24.0 | 이식성, 일관성 |
| **Orchestration** | Kubernetes | 1.28 | Auto Scaling, Self-healing |
| | K3s → EKS | - | 학습 → 프로덕션 |
| **Monitoring** | Prometheus | 2.45 | 메트릭 수집 |
| | Grafana | 10.0 | 시각화 |
| | Loki | 2.9 | 로그 저장 |

---

## 3. 네트워크 구성도 (VPC & Networking)

### 🌐 AWS VPC 아키텍처 (3-Tier)

```
┌────────────────────────────────────────────────────────────────────┐
│                     VPC: 10.0.0.0/16                               │
│                     tiketi-prod-vpc                                │
│                                                                    │
│  ┌──────────────────────────────────────────────────────────────┐ │
│  │            Internet Gateway (IGW)                            │ │
│  └────────────────────────┬─────────────────────────────────────┘ │
│                           │                                        │
│  ┌────────────────────────┴─────────────────────────────────────┐ │
│  │          🌍 Public Subnets (DMZ)                             │ │
│  │                                                               │ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │ │
│  │  │ us-east-1a   │  │ us-east-1b   │  │ us-east-1c   │      │ │
│  │  │ 10.0.1.0/24  │  │ 10.0.2.0/24  │  │ 10.0.3.0/24  │      │ │
│  │  │              │  │              │  │              │      │ │
│  │  │ • ALB        │  │ • ALB        │  │ • ALB        │      │ │
│  │  │ • NAT GW     │  │ • NAT GW     │  │ • NAT GW     │      │ │
│  │  │ • Bastion    │  │              │  │              │      │ │
│  │  └──────────────┘  └──────────────┘  └──────────────┘      │ │
│  └───────────────────────────────────────────────────────────────┘ │
│                           │                                        │
│  ┌────────────────────────┴─────────────────────────────────────┐ │
│  │          🔒 Private Subnets - Application Tier               │ │
│  │                                                               │ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │ │
│  │  │ us-east-1a   │  │ us-east-1b   │  │ us-east-1c   │      │ │
│  │  │ 10.0.11.0/24 │  │ 10.0.12.0/24 │  │ 10.0.13.0/24 │      │ │
│  │  │              │  │              │  │              │      │ │
│  │  │ • EKS Pods   │  │ • EKS Pods   │  │ • EKS Pods   │      │ │
│  │  │ • EC2 Worker │  │ • EC2 Worker │  │ • EC2 Worker │      │ │
│  │  │   Nodes      │  │   Nodes      │  │   Nodes      │      │ │
│  │  └──────────────┘  └──────────────┘  └──────────────┘      │ │
│  └───────────────────────────────────────────────────────────────┘ │
│                           │                                        │
│  ┌────────────────────────┴─────────────────────────────────────┐ │
│  │          🗄️  Private Subnets - Data Tier                     │ │
│  │                                                               │ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │ │
│  │  │ us-east-1a   │  │ us-east-1b   │  │ us-east-1c   │      │ │
│  │  │ 10.0.21.0/24 │  │ 10.0.22.0/24 │  │ 10.0.23.0/24 │      │ │
│  │  │              │  │              │  │              │      │ │
│  │  │ • RDS Aurora │  │ • RDS Aurora │  │ • RDS Aurora │      │ │
│  │  │   (Primary)  │  │   (Standby)  │  │   (Reader)   │      │ │
│  │  │ • ElastiCache│  │ • ElastiCache│  │ • ElastiCache│      │ │
│  │  │   (Primary)  │  │   (Replica)  │  │   (Replica)  │      │ │
│  │  └──────────────┘  └──────────────┘  └──────────────┘      │ │
│  └───────────────────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────────────┘

📊 트래픽 흐름:
1. 인터넷 → IGW → ALB (Public Subnet)
2. ALB → EKS Pod (Private App Subnet)
3. EKS Pod → RDS/Redis (Private Data Subnet)
4. Private Subnet → NAT GW → 외부 API (결제 등)
```

### 🔐 Security Groups

| 리소스 | 인바운드 허용 | 아웃바운드 |
|--------|--------------|-----------|
| **ALB** | 0.0.0.0/0:443 (HTTPS)<br>0.0.0.0/0:80 (HTTP→HTTPS 리다이렉트) | All |
| **EKS Pods** | ALB SG:3010-3015<br>Self (Pod 간 통신) | All |
| **RDS** | EKS Pods SG:5432<br>Bastion SG:5432 | None |
| **ElastiCache** | EKS Pods SG:6379 | None |
| **Bastion** | 사무실 IP:22 (SSH) | All |

### 🌐 네트워크 특징

```
✅ Multi-AZ (3 AZ): us-east-1a, 1b, 1c
✅ 고가용성: ALB, RDS, ElastiCache 모두 Multi-AZ
✅ 격리: Public/Private 분리 (보안)
✅ NAT Gateway: Private에서 외부 통신 (아웃바운드만)
✅ VPC Peering: 향후 Multi-VPC 확장 준비
```

---

## 4. 물리/하드웨어 구성도 (Infrastructure)

### 🖥️ EC2 인스턴스 및 컴퓨팅 리소스

```
┌────────────────────────────────────────────────────────────────────┐
│                    EKS Cluster: tiketi-prod                        │
└────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│  Control Plane (AWS 완전 관리형)                                 │
│  • Kubernetes Master Nodes (3대, Multi-AZ)                      │
│  • etcd 클러스터 (자동 백업)                                    │
│  • API Server, Controller Manager, Scheduler                    │
│  • AWS 자동 패치 및 업그레이드                                  │
│  • 비용: $72/월                                                 │
└─────────────────────────────────────────────────────────────────┘
                          │
        ┌─────────────────┼─────────────────┐
        ↓                 ↓                 ↓
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│  us-east-1a  │  │  us-east-1b  │  │  us-east-1c  │
└──────────────┘  └──────────────┘  └──────────────┘

┌────────────────────────────────────────────────────────────────────┐
│               Worker Nodes (Auto Scaling Group)                    │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  🟢 On-Demand 인스턴스 (기본 워크로드)                             │
│  ┌──────────────────────────────────────────────────────────┐    │
│  │ Instance Type: t3.xlarge                                 │    │
│  │ • vCPU: 4                                                │    │
│  │ • RAM: 16 GB                                             │    │
│  │ • 네트워크: Up to 5 Gbps                                 │    │
│  │ • EBS: 100 GB (gp3)                                      │    │
│  │                                                          │    │
│  │ 수량: 3대 (최소)                                         │    │
│  │ 용도: Auth, Admin, Payment 서비스 (중단 불가)            │    │
│  │ 비용: $0.1664/h × 3 × 720h = $360/월                     │    │
│  └──────────────────────────────────────────────────────────┘    │
│                                                                    │
│  🔵 Spot 인스턴스 (확장 워크로드, 70% 할인) 🔥                     │
│  ┌──────────────────────────────────────────────────────────┐    │
│  │ Instance Type: c6i.xlarge (컴퓨팅 최적화)                │    │
│  │ • vCPU: 4                                                │    │
│  │ • RAM: 8 GB                                              │    │
│  │ • 네트워크: Up to 12.5 Gbps                              │    │
│  │ • EBS: 50 GB (gp3)                                       │    │
│  │                                                          │    │
│  │ 수량: 0-40대 (Auto Scaling)                              │    │
│  │ 용도: Event, Queue, Reservation 서비스 (피크 대응)       │    │
│  │ 비용: $0.0499/h (Spot) × 10대 평균 × 720h = $359/월      │    │
│  │                                                          │    │
│  │ 특징:                                                     │    │
│  │ • 2분 경고 후 회수 가능 (Graceful Shutdown 처리)        │    │
│  │ • 여러 AZ에 분산 배치 (중단 리스크 완화)                 │    │
│  │ • Stateless 서비스만 배치                               │    │
│  └──────────────────────────────────────────────────────────┘    │
└────────────────────────────────────────────────────────────────────┘
```

### 💾 스토리지 구성

```
┌────────────────────────────────────────────────────────────────────┐
│                          스토리지 레이어                            │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  📀 EBS (Elastic Block Store) - EC2 볼륨                          │
│  ┌──────────────────────────────────────────────────────────┐    │
│  │ • 타입: gp3 (General Purpose SSD)                        │    │
│  │ • 크기: 100 GB (On-Demand), 50 GB (Spot)                 │    │
│  │ • IOPS: 3,000 (기본), 16,000 (최대)                      │    │
│  │ • 처리량: 125 MB/s (기본), 1,000 MB/s (최대)             │    │
│  │ • 스냅샷: 일 1회 자동 백업                               │    │
│  │ • 비용: $0.08/GB/월 × 500 GB = $40/월                    │    │
│  └──────────────────────────────────────────────────────────┘    │
│                                                                    │
│  🗂️  S3 (Simple Storage Service) - 객체 스토리지                 │
│  ┌──────────────────────────────────────────────────────────┐    │
│  │ Bucket 1: tiketi-frontend-prod                           │    │
│  │ • 용도: React 빌드 파일 (SPA)                            │    │
│  │ • 크기: ~100 MB                                          │    │
│  │ • 버저닝: Enabled                                        │    │
│  │ • CloudFront 연동                                        │    │
│  │                                                          │    │
│  │ Bucket 2: tiketi-images-prod                             │    │
│  │ • 용도: 이벤트 포스터, 사용자 업로드 이미지              │    │
│  │ • 크기: ~50 GB                                           │    │
│  │ • Lifecycle: 90일 후 Glacier (아카이빙)                  │    │
│  │ • 비용: $0.023/GB/월 × 50 GB = $1.15/월                  │    │
│  │                                                          │    │
│  │ Bucket 3: tiketi-backups                                 │    │
│  │ • 용도: DB 백업, 로그 아카이브                           │    │
│  │ • 크기: ~200 GB                                          │    │
│  │ • Encryption: AES-256                                    │    │
│  └──────────────────────────────────────────────────────────┘    │
│                                                                    │
│  💿 RDS Aurora 스토리지 (자동 확장)                               │
│  ┌──────────────────────────────────────────────────────────┐    │
│  │ • 초기: 10 GB                                            │    │
│  │ • 최대: 128 TB (자동 확장)                               │    │
│  │ • 복제: 6-way replication (AZ 간)                        │    │
│  │ • 백업: Point-in-Time Recovery (7일)                     │    │
│  │ • 비용: $0.10/GB/월 × 100 GB = $10/월                    │    │
│  └──────────────────────────────────────────────────────────┘    │
└────────────────────────────────────────────────────────────────────┘
```

### ⚙️ 컴퓨팅 리소스 요약

| 리소스 | 사양 | 수량 | 용도 | 비용/월 |
|--------|------|------|------|---------|
| **EKS Control Plane** | AWS 관리형 | 1 | K8s Master | $72 |
| **t3.xlarge (On-Demand)** | 4 vCPU, 16GB RAM | 3 | 기본 워크로드 | $360 |
| **c6i.xlarge (Spot)** | 4 vCPU, 8GB RAM | 0-40 | 피크 대응 | $359 |
| **EBS gp3** | SSD, 3K IOPS | 500GB | 영구 스토리지 | $40 |
| **S3** | 객체 스토리지 | 250GB | 정적 파일 | $6 |
| **RDS Aurora 스토리지** | Auto Scaling | 100GB | DB 데이터 | $10 |
| **총 컴퓨팅 비용** | | | | **$847/월** |

---

## 5. 운영 및 관리 구성도 (DevOps & Monitoring)

### 🔄 CI/CD 파이프라인

```
┌────────────────────────────────────────────────────────────────────┐
│                      개발자 워크플로우                              │
└────────────────────────────────────────────────────────────────────┘

1️⃣  개발 (Local)
    ↓
    git commit -m "Add new feature"
    git push origin main
    ↓
┌────────────────────────────────────────────────────────────────────┐
│  2️⃣  GitHub Actions (CI/CD)                                       │
│                                                                    │
│  ┌──────────────────────────────────────────────────────────┐    │
│  │ Stage 1: Test                                            │    │
│  │  • npm test (Unit Tests)                                │    │
│  │  • npm run lint (ESLint)                                │    │
│  │  • npm run build (빌드 검증)                            │    │
│  └──────────────────────────────────────────────────────────┘    │
│                          ↓                                         │
│  ┌──────────────────────────────────────────────────────────┐    │
│  │ Stage 2: Build Docker Image                              │    │
│  │  • docker build -t tiketi/auth-service:${GIT_SHA} .     │    │
│  │  • docker tag tiketi/auth-service:${GIT_SHA} latest     │    │
│  └──────────────────────────────────────────────────────────┘    │
│                          ↓                                         │
│  ┌──────────────────────────────────────────────────────────┐    │
│  │ Stage 3: Push to ECR                                     │    │
│  │  • aws ecr get-login-password                           │    │
│  │  • docker push 123456789012.dkr.ecr.../auth:${GIT_SHA} │    │
│  └──────────────────────────────────────────────────────────┘    │
│                          ↓                                         │
│  ┌──────────────────────────────────────────────────────────┐    │
│  │ Stage 4: Deploy to EKS                                   │    │
│  │  • kubectl set image deployment/auth-service \          │    │
│  │    auth-service=...ecr.../auth:${GIT_SHA}              │    │
│  │  • kubectl rollout status deployment/auth-service       │    │
│  └──────────────────────────────────────────────────────────┘    │
│                          ↓                                         │
│  ┌──────────────────────────────────────────────────────────┐    │
│  │ Stage 5: Verify                                          │    │
│  │  • Health Check (200 OK?)                               │    │
│  │  • Smoke Test (핵심 API 테스트)                         │    │
│  │  • Rollback (실패 시 자동 복구)                         │    │
│  └──────────────────────────────────────────────────────────┘    │
│                          ↓                                         │
│  ┌──────────────────────────────────────────────────────────┐    │
│  │ Stage 6: Notify                                          │    │
│  │  • Slack 알림 (배포 성공/실패)                          │    │
│  │  • GitHub PR 상태 업데이트                              │    │
│  └──────────────────────────────────────────────────────────┘    │
└────────────────────────────────────────────────────────────────────┘

⏱️  전체 소요 시간: 5-10분
```

### 📊 모니터링 스택

```
┌────────────────────────────────────────────────────────────────────┐
│                        모니터링 아키텍처                            │
└────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────┐
│  🎯 Prometheus (메트릭 수집)                                 │
│                                                              │
│  수집 대상:                                                  │
│  • Kubernetes Metrics (kube-state-metrics)                  │
│  • Node Metrics (node-exporter)                             │
│  • Application Metrics (각 서비스 /metrics 엔드포인트)      │
│  • Custom Metrics (예매 생성, 대기열 길이 등)               │
│                                                              │
│  저장 기간: 15일                                             │
│  Scrape Interval: 15초                                       │
└──────────────────────┬───────────────────────────────────────┘
                       │
                       ↓
┌──────────────────────────────────────────────────────────────┐
│  📈 Grafana (시각화)                                         │
│                                                              │
│  대시보드:                                                   │
│  1. Kubernetes Cluster Overview                             │
│     • 클러스터 상태, 노드 리소스, Pod 상태                  │
│  2. Service Performance                                      │
│     • 요청 수, 응답 시간, 에러율 (RED 메트릭)               │
│  3. Business Metrics                                         │
│     • 예매 생성/취소, 대기열 길이, 좌석 선택                │
│  4. Database & Cache                                         │
│     • RDS 연결 수, CPU, 쿼리 성능, Redis 메모리             │
│                                                              │
│  알림:                                                       │
│  • CPU > 80% (5분 이상)                                      │
│  • 에러율 > 1%                                               │
│  • 응답 시간 > 1초 (p99)                                     │
│  • 대기열 > 100,000명                                        │
└──────────────────────┬───────────────────────────────────────┘
                       │
                       ↓
┌──────────────────────────────────────────────────────────────┐
│  🔔 Alertmanager (알림 라우팅)                               │
│                                                              │
│  알림 채널:                                                  │
│  • Slack (#alerts-prod)                                     │
│  • Email (oncall@tiketi.gg)                                 │
│  • PagerDuty (Critical 알림)                                │
│                                                              │
│  알림 그룹화:                                                │
│  • 5분 이내 동일 알림 묶음 (스팸 방지)                      │
│  • 심각도별 라우팅 (Critical → PagerDuty)                   │
└──────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────┐
│  📝 Loki (로그 수집)                                         │
│                                                              │
│  로그 소스:                                                  │
│  • Kubernetes Pod Logs (stdout/stderr)                      │
│  • Application Logs (Winston JSON 포맷)                     │
│  • Nginx Ingress Logs                                       │
│  • Audit Logs (K8s API Server)                              │
│                                                              │
│  저장 기간: 30일                                             │
│  인덱싱: Label 기반 (namespace, pod, level)                 │
└──────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────┐
│  🔍 X-Ray (분산 추적)                                        │
│                                                              │
│  추적 범위:                                                  │
│  • API Gateway → Auth Service                               │
│  • Reservation Service → Payment Service                    │
│  • 모든 DB 쿼리                                              │
│  • 외부 API 호출 (토스페이먼츠)                             │
│                                                              │
│  용도:                                                       │
│  • 병목 지점 파악                                            │
│  • 에러 원인 분석                                            │
│  • 서비스 의존성 맵                                          │
└──────────────────────────────────────────────────────────────┘
```

### 🛠️ 운영 도구

| 도구 | 용도 | 접근 방법 |
|------|------|----------|
| **kubectl** | K8s 클러스터 관리 | CLI |
| **Lens** | K8s GUI 관리 | Desktop App |
| **Grafana** | 메트릭 시각화 | https://grafana.tiketi.gg |
| **Prometheus** | 메트릭 쿼리 | https://prometheus.tiketi.gg |
| **Kibana** | 로그 검색 (Loki UI) | https://loki.tiketi.gg |
| **AWS Console** | AWS 리소스 관리 | Web |
| **Terraform** | Infrastructure as Code | CLI |

---

## 6. 데이터베이스 구성도 (Data Layer)

### 💾 데이터베이스 아키텍처

```
┌────────────────────────────────────────────────────────────────────┐
│                     RDS Aurora PostgreSQL Cluster                  │
└────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────┐
│  📝 Writer Instance (Primary)                                    │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │ Endpoint: tiketi-prod.cluster-xxx.rds.amazonaws.com        │ │
│  │ Instance: db.r6g.2xlarge (8 vCPU, 64GB RAM)                │ │
│  │ AZ: us-east-1a                                             │ │
│  │                                                            │ │
│  │ 용도:                                                       │ │
│  │ • 모든 쓰기 작업 (INSERT, UPDATE, DELETE)                 │ │
│  │ • Reservation Service (예매 생성/취소)                    │ │
│  │ • Payment Service (결제 처리)                             │ │
│  │ • Admin Service (이벤트 생성/수정)                        │ │
│  │                                                            │ │
│  │ Connection Pool: 200 (최대)                                │ │
│  │ 비용: $0.96/h × 720h = $691/월                             │ │
│  └────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────┘
                          │
                          ↓ (자동 복제)
┌──────────────────────────────────────────────────────────────────┐
│  📖 Reader Instances (Read Replicas, Auto Scaling: 1-8개)        │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │ Endpoint: tiketi-prod.cluster-ro-xxx.rds.amazonaws.com     │ │
│  │ (Round Robin 자동 분산)                                    │ │
│  │                                                            │ │
│  │ Reader 1 (us-east-1b): db.r6g.xlarge (4 vCPU, 32GB RAM)   │ │
│  │ Reader 2 (us-east-1c): db.r6g.xlarge                       │ │
│  │ Reader 3-8: Auto Scaling (CPU > 70% 시 추가)              │ │
│  │                                                            │ │
│  │ 용도:                                                       │ │
│  │ • 모든 읽기 작업 (SELECT)                                  │ │
│  │ • Event Service (이벤트 목록/상세 조회)                   │ │
│  │ • Auth Service (사용자 정보 조회)                         │ │
│  │ • Analytics Service (통계 쿼리)                           │ │
│  │                                                            │ │
│  │ Connection Pool: 100 (각 Reader당)                         │ │
│  │ 복제 지연: <10ms (동일 리전 내)                            │ │
│  │ 비용: $0.48/h × 2 × 720h = $691/월 (기본 2개)              │ │
│  └────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────┘

💿 공유 스토리지 (Aurora 특징)
┌──────────────────────────────────────────────────────────────────┐
│ • Writer/Reader 모두 동일한 스토리지 공유                         │
│ • 6-way replication (AZ 간 자동 복제)                            │
│ • 자동 확장: 10GB → 128TB                                        │
│ • Point-in-Time Recovery: 최대 35일                              │
│ • 자동 백업: 매일 03:00-04:00 (UTC)                              │
└──────────────────────────────────────────────────────────────────┘
```

### 🗂️ 데이터베이스 스키마 구조

```
┌────────────────────────────────────────────────────────────────────┐
│                     tiketi Database Schema                         │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  👤 users (사용자)                                                 │
│  ┌──────────────────────────────────────────────────────────┐    │
│  │ id (UUID, PK)                                            │    │
│  │ email (VARCHAR, UNIQUE)                                  │    │
│  │ password_hash (VARCHAR)                                  │    │
│  │ name (VARCHAR)                                           │    │
│  │ role (VARCHAR: 'user' | 'admin')                         │    │
│  │ created_at, updated_at (TIMESTAMP)                       │    │
│  └──────────────────────────────────────────────────────────┘    │
│  인덱스: email (UNIQUE)                                            │
│  행 수: ~100,000 (예상)                                            │
│                                                                    │
│  🎭 events (이벤트)                                                │
│  ┌──────────────────────────────────────────────────────────┐    │
│  │ id (UUID, PK)                                            │    │
│  │ title (VARCHAR)                                          │    │
│  │ description (TEXT)                                       │    │
│  │ venue (VARCHAR)                                          │    │
│  │ event_date (TIMESTAMP)                                   │    │
│  │ sale_start_date, sale_end_date (TIMESTAMP)               │    │
│  │ poster_image_url (TEXT)                                  │    │
│  │ status (VARCHAR: 'upcoming'|'on_sale'|'sold_out'...)     │    │
│  │ seat_layout_id (UUID, FK)                                │    │
│  │ created_at, updated_at (TIMESTAMP)                       │    │
│  └──────────────────────────────────────────────────────────┘    │
│  인덱스: event_date, status, artist_name                           │
│  행 수: ~10,000 (예상)                                             │
│                                                                    │
│  🪑 seats (좌석)                                                   │
│  ┌──────────────────────────────────────────────────────────┐    │
│  │ id (UUID, PK)                                            │    │
│  │ event_id (UUID, FK)                                      │    │
│  │ section (VARCHAR: 'VIP', 'R석', 'S석')                   │    │
│  │ row_number, seat_number (INTEGER)                        │    │
│  │ seat_label (VARCHAR: 'VIP-1-5')                          │    │
│  │ price (INTEGER)                                          │    │
│  │ status (VARCHAR: 'available'|'locked'|'reserved')        │    │
│  │ created_at, updated_at (TIMESTAMP)                       │    │
│  └──────────────────────────────────────────────────────────┘    │
│  인덱스: event_id, status, section                                 │
│  행 수: ~5,000,000 (이벤트당 500석 × 10,000 이벤트)               │
│                                                                    │
│  🎫 reservations (예매)                                            │
│  ┌──────────────────────────────────────────────────────────┐    │
│  │ id (UUID, PK)                                            │    │
│  │ user_id (UUID, FK)                                       │    │
│  │ event_id (UUID, FK)                                      │    │
│  │ reservation_number (VARCHAR, UNIQUE)                     │    │
│  │ total_amount (INTEGER)                                   │    │
│  │ status (VARCHAR: 'pending'|'confirmed'|'cancelled')      │    │
│  │ payment_method (VARCHAR)                                 │    │
│  │ payment_status (VARCHAR)                                 │    │
│  │ expires_at (TIMESTAMP)                                   │    │
│  │ created_at, updated_at (TIMESTAMP)                       │    │
│  └──────────────────────────────────────────────────────────┘    │
│  인덱스: user_id, event_id, status, reservation_number             │
│  행 수: ~2,000,000 (예상)                                          │
│                                                                    │
│  💳 payments (결제)                                                │
│  ┌──────────────────────────────────────────────────────────┐    │
│  │ id (UUID, PK)                                            │    │
│  │ reservation_id (UUID, FK)                                │    │
│  │ amount (INTEGER)                                         │    │
│  │ payment_key (VARCHAR)                                    │    │
│  │ provider (VARCHAR: 'toss'|'kakao')                       │    │
│  │ status (VARCHAR: 'pending'|'completed'|'failed')         │    │
│  │ created_at, updated_at (TIMESTAMP)                       │    │
│  └──────────────────────────────────────────────────────────┘    │
│  인덱스: reservation_id, payment_key                               │
│  행 수: ~2,000,000 (예상)                                          │
│                                                                    │
│  총 9개 테이블, 예상 총 데이터: ~100 GB                            │
└────────────────────────────────────────────────────────────────────┘
```

### 🔴 Redis (ElastiCache) 구조

```
┌────────────────────────────────────────────────────────────────────┐
│              ElastiCache Redis Cluster (Cluster Mode)              │
└────────────────────────────────────────────────────────────────────┘

📊 Shard 구조 (6 Shards × 2 Nodes = 12 Nodes)

Shard 1 (대기열 전담) 🔥
├─ Primary: cache.r6g.xlarge (26.32 GB RAM)
└─ Replica: cache.r6g.xlarge (us-east-1b)
데이터:
• queue:{eventId} → Sorted Set (타임스탬프 기준)
• active:{eventId} → Set (활성 사용자)
예상 메모리: ~10 GB (100만명 대기열)

Shard 2 (분산 락 전담)
├─ Primary: cache.r6g.xlarge
└─ Replica: cache.r6g.xlarge
데이터:
• lock:seat:{eventId}:{seatId} → String (userId), TTL 10s
• lock:ticket:{ticketTypeId} → String (userId), TTL 10s
예상 메모리: ~2 GB

Shard 3-6 (캐싱 및 세션)
각 Shard: Primary + Replica
데이터:
• event:{eventId} → Hash (이벤트 상세), TTL 30s
• events:all:{page}:{limit} → JSON, TTL 30s
• socket:session:{userId} → Hash (세션 정보), TTL 3600s
예상 메모리: ~5 GB × 4 = 20 GB

총 메모리: ~32 GB (12 노드 × 26.32 GB = 315 GB 중 10% 사용)
비용: $0.315/h × 12 × 720h = $2,721/월 (Reserved로 40% 절감)
```

### 📊 데이터 흐름

```
쓰기 (Write):
사용자 → Reservation Service → RDS Writer → 자동 복제 → Readers

읽기 (Read):
사용자 → Event Service → Redis 캐시 확인
                          ├─ Hit → 즉시 응답 (1ms)
                          └─ Miss → RDS Reader → 캐시 갱신 (50ms)

트랜잭션 (Transaction):
Reservation Service → RDS Writer (BEGIN → INSERT → UPDATE → COMMIT)
                   → Redis (분산 락 획득/해제)
```

---

계속해서 나머지 다이어그램(보안 구성도, MSA 다이어그램)을 작성하겠습니다...