<mxfile host="app.diagrams.net">
  <diagram id="data-flow" name="Data Flow - Ticket Booking Process">
    <mxGraphModel dx="1422" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="TIKETI - Data Flow: Complete Ticket Booking Journey" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="600" height="40" as="geometry" />
        </mxCell>

        <!-- User -->
        <mxCell id="user" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#232F3D;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.user;" vertex="1" parent="1">
          <mxGeometry x="80" y="100" width="60" height="60" as="geometry" />
        </mxCell>
        <mxCell id="user-label" value="User" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="70" y="165" width="80" height="20" as="geometry" />
        </mxCell>

        <!-- CloudFront -->
        <mxCell id="cloudfront" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;fillColor=#8C4FFF;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.cloudfront;" vertex="1" parent="1">
          <mxGeometry x="240" y="95" width="70" height="70" as="geometry" />
        </mxCell>
        <mxCell id="cloudfront-label" value="CloudFront&#xa;+ WAF" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="225" y="170" width="100" height="30" as="geometry" />
        </mxCell>

        <!-- ALB -->
        <mxCell id="alb" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;fillColor=#8C4FFF;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.application_load_balancer;" vertex="1" parent="1">
          <mxGeometry x="400" y="95" width="70" height="70" as="geometry" />
        </mxCell>
        <mxCell id="alb-label" value="ALB" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="385" y="170" width="100" height="20" as="geometry" />
        </mxCell>

        <!-- Microservices Group Container -->
        <mxCell id="services-container" value="EKS Cluster - Microservices" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6F2FF;strokeColor=#6c8ebf;verticalAlign=top;align=left;spacingLeft=15;fontSize=13;fontStyle=1;dashed=1;dashPattern=5 5;" vertex="1" parent="1">
          <mxGeometry x="560" y="80" width="620" height="180" as="geometry" />
        </mxCell>

        <!-- Auth Service -->
        <mxCell id="auth-svc" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;align=center;" vertex="1" parent="1">
          <mxGeometry x="590" y="120" width="100" height="100" as="geometry" />
        </mxCell>
        <mxCell id="auth-icon" value="ðŸ”" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=30;" vertex="1" parent="1">
          <mxGeometry x="610" y="130" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="auth-label" value="Auth&#xa;Service" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="600" y="175" width="80" height="30" as="geometry" />
        </mxCell>

        <!-- Event Service -->
        <mxCell id="event-svc" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;align=center;" vertex="1" parent="1">
          <mxGeometry x="720" y="120" width="100" height="100" as="geometry" />
        </mxCell>
        <mxCell id="event-icon" value="ðŸŽ«" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=30;" vertex="1" parent="1">
          <mxGeometry x="740" y="130" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="event-label" value="Event&#xa;Service" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="730" y="175" width="80" height="30" as="geometry" />
        </mxCell>

        <!-- Queue Service -->
        <mxCell id="queue-svc" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;align=center;" vertex="1" parent="1">
          <mxGeometry x="850" y="120" width="100" height="100" as="geometry" />
        </mxCell>
        <mxCell id="queue-icon" value="â³" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=30;" vertex="1" parent="1">
          <mxGeometry x="870" y="130" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="queue-label" value="Queue&#xa;Service" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="860" y="175" width="80" height="30" as="geometry" />
        </mxCell>

        <!-- Reservation Service -->
        <mxCell id="reservation-svc" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;align=center;" vertex="1" parent="1">
          <mxGeometry x="980" y="120" width="100" height="100" as="geometry" />
        </mxCell>
        <mxCell id="reservation-icon" value="ðŸ“" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=30;" vertex="1" parent="1">
          <mxGeometry x="1000" y="130" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="reservation-label" value="Reservation&#xa;Service" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="985" y="175" width="90" height="30" as="geometry" />
        </mxCell>

        <!-- Payment Service -->
        <mxCell id="payment-svc" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;verticalAlign=top;align=center;" vertex="1" parent="1">
          <mxGeometry x="1240" y="120" width="100" height="100" as="geometry" />
        </mxCell>
        <mxCell id="payment-icon" value="ðŸ’³" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=30;" vertex="1" parent="1">
          <mxGeometry x="1260" y="130" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="payment-label" value="Payment&#xa;Service" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1250" y="175" width="80" height="30" as="geometry" />
        </mxCell>

        <!-- Redis Cache -->
        <mxCell id="redis" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;fillColor=#C925D1;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.elasticache;" vertex="1" parent="1">
          <mxGeometry x="820" y="340" width="70" height="70" as="geometry" />
        </mxCell>
        <mxCell id="redis-label" value="ElastiCache&#xa;Redis Cluster" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="805" y="415" width="100" height="30" as="geometry" />
        </mxCell>

        <!-- RDS Aurora -->
        <mxCell id="rds" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;fillColor=#C925D1;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.aurora;" vertex="1" parent="1">
          <mxGeometry x="995" y="340" width="70" height="70" as="geometry" />
        </mxCell>
        <mxCell id="rds-label" value="RDS Aurora&#xa;PostgreSQL" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="980" y="415" width="100" height="30" as="geometry" />
        </mxCell>

        <!-- Message Queue -->
        <mxCell id="mq" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;fillColor=#E7157B;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.sqs;" vertex="1" parent="1">
          <mxGeometry x="650" y="340" width="70" height="70" as="geometry" />
        </mxCell>
        <mxCell id="mq-label" value="Message Queue&#xa;(RabbitMQ/SQS)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="625" y="415" width="120" height="30" as="geometry" />
        </mxCell>

        <!-- External Payment Gateway -->
        <mxCell id="pg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF4E6;strokeColor=#d79b00;verticalAlign=top;align=center;" vertex="1" parent="1">
          <mxGeometry x="1410" y="120" width="120" height="100" as="geometry" />
        </mxCell>
        <mxCell id="pg-icon" value="ðŸ¦" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=30;" vertex="1" parent="1">
          <mxGeometry x="1440" y="130" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="pg-label" value="External&#xa;Payment&#xa;Gateway" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1420" y="170" width="100" height="40" as="geometry" />
        </mxCell>

        <!-- FLOW ARROWS with Numbers -->

        <!-- Step 1: User to CloudFront -->
        <mxCell id="flow1" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#1976D2;" edge="1" parent="1" source="user" target="cloudfront">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="400" as="sourcePoint" />
            <mxPoint x="750" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow1-label" value="â‘ " style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#1976D2;strokeColor=none;fontColor=#FFFFFF;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="165" y="105" width="35" height="35" as="geometry" />
        </mxCell>
        <mxCell id="flow1-text" value="HTTPS Request" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#1976D2;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="145" y="80" width="80" height="20" as="geometry" />
        </mxCell>

        <!-- Step 2: CloudFront to ALB -->
        <mxCell id="flow2" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#1976D2;" edge="1" parent="1" source="cloudfront" target="alb">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="400" as="sourcePoint" />
            <mxPoint x="750" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow2-label" value="â‘¡" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#1976D2;strokeColor=none;fontColor=#FFFFFF;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="330" y="105" width="35" height="35" as="geometry" />
        </mxCell>

        <!-- Step 3: ALB to Auth -->
        <mxCell id="flow3" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#388E3C;" edge="1" parent="1" source="alb" target="auth-svc">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="400" as="sourcePoint" />
            <mxPoint x="750" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow3-label" value="â‘¢" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#388E3C;strokeColor=none;fontColor=#FFFFFF;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="510" y="105" width="35" height="35" as="geometry" />
        </mxCell>
        <mxCell id="flow3-text" value="POST /login" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#388E3C;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="490" y="80" width="80" height="20" as="geometry" />
        </mxCell>

        <!-- Step 4: Auth to RDS -->
        <mxCell id="flow4" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#388E3C;dashed=1;" edge="1" parent="1" source="auth-svc" target="rds">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="400" as="sourcePoint" />
            <mxPoint x="750" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow4-label" value="â‘£" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#388E3C;strokeColor=none;fontColor=#FFFFFF;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="730" y="270" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="flow4-text" value="Verify User" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#388E3C;" vertex="1" parent="1">
          <mxGeometry x="730" y="250" width="70" height="15" as="geometry" />
        </mxCell>

        <!-- Step 5: Return JWT -->
        <mxCell id="flow5" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#388E3C;startArrow=classic;startFill=1;" edge="1" parent="1" source="user" target="auth-svc">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="400" as="sourcePoint" />
            <mxPoint x="750" y="350" as="targetPoint" />
            <Array as="points">
              <mxPoint x="110" y="240" />
              <mxPoint x="640" y="240" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="flow5-text" value="â‘¤ JWT Token" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#388E3C;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="330" y="250" width="100" height="20" as="geometry" />
        </mxCell>

        <!-- Step 6: Browse Events -->
        <mxCell id="flow6" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#F57C00;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="470" y="130" as="sourcePoint" />
            <mxPoint x="720" y="150" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow6-label" value="â‘¥" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#F57C00;strokeColor=none;fontColor=#FFFFFF;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="550" y="115" width="35" height="35" as="geometry" />
        </mxCell>
        <mxCell id="flow6-text" value="GET /events" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#F57C00;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="560" y="95" width="80" height="20" as="geometry" />
        </mxCell>

        <!-- Step 7: Cache Check -->
        <mxCell id="flow7" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#F57C00;startArrow=classic;startFill=1;dashed=1;" edge="1" parent="1" source="event-svc" target="redis">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="400" as="sourcePoint" />
            <mxPoint x="750" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow7-label" value="â‘¦" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#F57C00;strokeColor=none;fontColor=#FFFFFF;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="820" y="270" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="flow7-text" value="Cache Hit" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#F57C00;" vertex="1" parent="1">
          <mxGeometry x="820" y="250" width="60" height="15" as="geometry" />
        </mxCell>

        <!-- Step 8: Join Queue -->
        <mxCell id="flow8" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#7B1FA2;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="470" y="150" as="sourcePoint" />
            <mxPoint x="850" y="165" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow8-label" value="â‘§" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#7B1FA2;strokeColor=none;fontColor=#FFFFFF;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="640" y="140" width="35" height="35" as="geometry" />
        </mxCell>
        <mxCell id="flow8-text" value="WebSocket&#xa;/queue/join" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#7B1FA2;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="630" y="115" width="80" height="25" as="geometry" />
        </mxCell>

        <!-- Step 9: Queue to Redis -->
        <mxCell id="flow9" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#7B1FA2;startArrow=classic;startFill=1;dashed=1;" edge="1" parent="1" source="queue-svc" target="redis">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="400" as="sourcePoint" />
            <mxPoint x="750" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow9-label" value="â‘¨" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#7B1FA2;strokeColor=none;fontColor=#FFFFFF;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="870" y="270" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="flow9-text" value="Queue Position" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#7B1FA2;" vertex="1" parent="1">
          <mxGeometry x="865" y="250" width="80" height="15" as="geometry" />
        </mxCell>

        <!-- Step 10: Book Ticket -->
        <mxCell id="flow10" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#C62828;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="470" y="170" as="sourcePoint" />
            <mxPoint x="980" y="180" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow10-label" value="â‘©" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#C62828;strokeColor=none;fontColor=#FFFFFF;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="710" y="160" width="35" height="35" as="geometry" />
        </mxCell>
        <mxCell id="flow10-text" value="POST /reserve" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#C62828;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="680" y="138" width="90" height="20" as="geometry" />
        </mxCell>

        <!-- Step 11: Reservation to RDS -->
        <mxCell id="flow11" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#C62828;dashed=1;" edge="1" parent="1" source="reservation-svc" target="rds">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="400" as="sourcePoint" />
            <mxPoint x="750" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow11-label" value="â‘ª" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#C62828;strokeColor=none;fontColor=#FFFFFF;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1020" y="270" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="flow11-text" value="Lock Seat&#xa;(Pessimistic)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#C62828;" vertex="1" parent="1">
          <mxGeometry x="1010" y="240" width="80" height="25" as="geometry" />
        </mxCell>

        <!-- Step 12: Async Payment Event -->
        <mxCell id="flow12" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#C62828;dashed=1;" edge="1" parent="1" source="reservation-svc" target="mq">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="400" as="sourcePoint" />
            <mxPoint x="750" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow12-label" value="â‘«" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#C62828;strokeColor=none;fontColor=#FFFFFF;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="840" y="270" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="flow12-text" value="Payment&#xa;Event" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#C62828;" vertex="1" parent="1">
          <mxGeometry x="830" y="240" width="60" height="25" as="geometry" />
        </mxCell>

        <!-- Step 13: Payment Service Consume -->
        <mxCell id="flow13" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#E65100;" edge="1" parent="1" source="mq" target="payment-svc">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="400" as="sourcePoint" />
            <mxPoint x="750" y="350" as="targetPoint" />
            <Array as="points">
              <mxPoint x="685" y="300" />
              <mxPoint x="1290" y="300" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="flow13-label" value="â‘¬" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#E65100;strokeColor=none;fontColor=#FFFFFF;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="960" y="285" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="flow13-text" value="Consume Event" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#E65100;" vertex="1" parent="1">
          <mxGeometry x="950" y="265" width="90" height="15" as="geometry" />
        </mxCell>

        <!-- Step 14: Payment to PG -->
        <mxCell id="flow14" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#E65100;" edge="1" parent="1" source="payment-svc" target="pg">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="400" as="sourcePoint" />
            <mxPoint x="750" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow14-label" value="â‘­" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#E65100;strokeColor=none;fontColor=#FFFFFF;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1355" y="145" width="35" height="35" as="geometry" />
        </mxCell>
        <mxCell id="flow14-text" value="API Call" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#E65100;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1340" y="120" width="60" height="20" as="geometry" />
        </mxCell>

        <!-- Step 15: Update Status -->
        <mxCell id="flow15" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#E65100;dashed=1;" edge="1" parent="1" source="payment-svc" target="rds">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="400" as="sourcePoint" />
            <mxPoint x="750" y="350" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1290" y="310" />
              <mxPoint x="1030" y="310" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="flow15-label" value="â‘®" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#E65100;strokeColor=none;fontColor=#FFFFFF;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1130" y="295" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="flow15-text" value="Update&#xa;PAID" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#E65100;" vertex="1" parent="1">
          <mxGeometry x="1120" y="265" width="50" height="25" as="geometry" />
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFEF7;strokeColor=#999999;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="80" y="520" width="520" height="420" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" value="Data Flow Steps" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="95" y="530" width="200" height="25" as="geometry" />
        </mxCell>

        <mxCell id="legend-auth" value="ðŸ” Authentication Flow (Steps â‘ -â‘¤):" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#388E3C;" vertex="1" parent="1">
          <mxGeometry x="95" y="565" width="300" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-auth-detail" value="â‘  User sends HTTPS request to CloudFront&#xa;â‘¡ CloudFront forwards to ALB (after WAF check)&#xa;â‘¢ ALB routes to Auth Service&#xa;â‘£ Auth Service verifies credentials in RDS&#xa;â‘¤ JWT token returned to user (7-day expiry)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="105" y="590" width="480" height="70" as="geometry" />
        </mxCell>

        <mxCell id="legend-browse" value="ðŸŽ« Event Browsing Flow (Steps â‘¥-â‘¦):" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#F57C00;" vertex="1" parent="1">
          <mxGeometry x="95" y="670" width="300" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-browse-detail" value="â‘¥ User requests event list (GET /events)&#xa;â‘¦ Event Service checks Redis cache first (90% hit rate)&#xa;   Cache miss â†’ Query RDS Aurora Read Replica" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="105" y="695" width="480" height="50" as="geometry" />
        </mxCell>

        <mxCell id="legend-queue" value="â³ Queue System (Steps â‘§-â‘¨):" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#7B1FA2;" vertex="1" parent="1">
          <mxGeometry x="95" y="755" width="300" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-queue-detail" value="â‘§ WebSocket connection established (/queue/join)&#xa;â‘¨ Queue position stored in Redis, real-time updates&#xa;   Socket.IO Redis Adapter for horizontal scaling" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="105" y="780" width="480" height="50" as="geometry" />
        </mxCell>

        <mxCell id="legend-booking" value="ðŸ“ Reservation (Steps â‘©-â‘«):" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#C62828;" vertex="1" parent="1">
          <mxGeometry x="95" y="840" width="300" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-booking-detail" value="â‘© User submits reservation (POST /reserve)&#xa;â‘ª Pessimistic Lock on seat (SELECT FOR UPDATE)&#xa;â‘« Saga pattern: Publish payment event to RabbitMQ" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="105" y="865" width="480" height="50" as="geometry" />
        </mxCell>

        <mxCell id="legend-payment" value="ðŸ’³ Payment Processing (Steps â‘¬-â‘®):" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#E65100;" vertex="1" parent="1">
          <mxGeometry x="95" y="870" width="300" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-payment-detail" value="â‘¬ Payment Service consumes event from queue&#xa;â‘­ Circuit Breaker pattern for external PG API&#xa;â‘® Update reservation status to PAID in RDS" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="105" y="895" width="480" height="50" as="geometry" />
        </mxCell>

        <!-- Performance Stats -->
        <mxCell id="perf-box" value="âš¡ Performance Metrics:&#xa;&#xa;â€¢ Event List Query: &lt;50ms (Redis cache)&#xa;â€¢ Reservation Lock: &lt;100ms (DB optimistic lock)&#xa;â€¢ Payment API: 1-3s (external, with timeout)&#xa;â€¢ WebSocket Latency: &lt;20ms&#xa;â€¢ Throughput: 10,000 req/sec (peak)&#xa;â€¢ Concurrent Users: 100,000+&#xa;&#xa;ðŸ”„ Resilience Patterns:&#xa;â€¢ Circuit Breaker: Payment Gateway&#xa;â€¢ Retry: 3 attempts with exponential backoff&#xa;â€¢ Timeout: 5s for external APIs&#xa;â€¢ Saga Compensation: Auto-refund on failure" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="650" y="520" width="300" height="270" as="geometry" />
        </mxCell>

        <!-- Data Storage Info -->
        <mxCell id="storage-box" value="ðŸ’¾ Data Storage Strategy:&#xa;&#xa;ðŸ“Š RDS Aurora PostgreSQL:&#xa;â€¢ 1 Writer + 8 Read Replicas&#xa;â€¢ Write: User, Reservation, Payment&#xa;â€¢ Read: Event browsing, history&#xa;â€¢ Auto-scaling Read Replicas&#xa;&#xa;âš¡ ElastiCache Redis:&#xa;â€¢ 6 Shards (Cluster Mode)&#xa;â€¢ Cache: Event list, user session&#xa;â€¢ Queue: WebSocket connections&#xa;â€¢ Distributed Lock: Seat locking&#xa;â€¢ TTL: 5 minutes (event cache)&#xa;&#xa;ðŸ“® Message Queue:&#xa;â€¢ RabbitMQ / AWS SQS&#xa;â€¢ Async: Payment, notifications&#xa;â€¢ Dead Letter Queue for failures" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#FF9800;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="990" y="520" width="300" height="340" as="geometry" />
        </mxCell>

        <!-- CQRS Pattern -->
        <mxCell id="cqrs-box" value="ðŸ”€ CQRS Pattern:&#xa;&#xa;Write Operations (Commands):&#xa;â†’ Primary RDS Writer Instance&#xa;  â€¢ User registration&#xa;  â€¢ Reservation creation&#xa;  â€¢ Payment confirmation&#xa;&#xa;Read Operations (Queries):&#xa;â†’ Redis Cache (first priority)&#xa;â†’ RDS Read Replicas (cache miss)&#xa;  â€¢ Event browsing&#xa;  â€¢ User profile&#xa;  â€¢ Reservation history&#xa;&#xa;Cache Invalidation:&#xa;â€¢ Write-through on updates&#xa;â€¢ TTL-based expiry (5 min)&#xa;â€¢ Redis Pub/Sub for real-time" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#2196F3;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1330" y="340" width="280" height="300" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
